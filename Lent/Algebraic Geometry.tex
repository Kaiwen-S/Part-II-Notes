\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{enumerate,bbm}
\usepackage{leftindex}
\usepackage{tikz,tikz-cd,graphicx,color,mathrsfs,color,hyperref,boldline}
\usepackage{caption,float}
\usepackage[a4paper,margin=1in,footskip=0.25in]{geometry}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{wasysym}
\usepackage{tabularx,capt-of}

\usepackage{blindtext}
%Image-related packages
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage[export]{adjustbox}
\usepackage{lipsum}

%hyperref setup
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
    pdftitle={Overleaf Example},
    pdfpagemode=FullScreen,
    }

%New colors defined below
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

%Code listing style named "mystyle"
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{backcolour}, commentstyle=\color{codegreen},
  keywordstyle=\color{magenta},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codepurple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,         
  breaklines=true,                 
  captionpos=b,                    
  keepspaces=true,                 
  numbers=left,                    
  numbersep=5pt,                  
  showspaces=false,                
  showstringspaces=false,
  showtabs=false,                  
  tabsize=2
}

%"mystyle" code listing set
\lstset{style=mystyle}

\theoremstyle{definition}
\newtheorem{defn}{Definition}[section]
\newtheorem{example}[defn]{Example}
\theoremstyle{remark}
\newtheorem{rem}{Remark}
\newtheorem{remS}[section]{defn}
\theoremstyle{plain}
\newtheorem{lem}[defn]{Lemma}
\newtheorem{thm}[defn]{Theorem}
\newtheorem{prop}[defn]{Proposition}
\newtheorem{fact}[defn]{Fact}
\newtheorem{crly}[defn]{Corollary}
\newtheorem{conj}[defn]{Conjecture}

%\newtheorem*{programming*}{Programming Task}

%\newtheorem{innercustomgeneric}{\customgenericname}
%\providecommand{\customgenericname}{}
%\newcommand{\newcustomtheorem}[2]{%
%  \newenvironment{#1}[1]
%  {%
%   \renewcommand\customgenericname{#2}%
%   \renewcommand\theinnercustomgeneric{##1}%
%   \innercustomgeneric
%  }
%  {\endinnercustomgeneric}
%}

%\newcustomtheorem{question}{Question}
%\newcustomtheorem{programming}{Programming Task}

\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\bA}{\mathbb{A}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\im}{\operatorname{im}}
\newcommand{\id}{\operatorname{id}}
\newcommand{\Ind}{\operatorname{Ind}}
\newcommand{\Res}{\operatorname{Res}}
\newcommand{\e}{\varepsilon}
\newcommand{\cl}{\operatorname{Cl}}
\newcommand{\divi}{\operatorname{div}}
\newcommand{\calD}{\mathcal{D}}

\newcommand{\sol}{\textit{Solution: }}

\newcommand\dashto{\mathrel{
  -\mkern-6mu{\to}\mkern-20mu{\color{white}\bullet}\mkern12mu
}}

\title{Algebraic Geometry}
\author{Kevin Song}
\date{January 2025}

\begin{document}
\maketitle
\section{Motivating Examples and Introduction}
\[\backslash:\tag{Owen's signature}\]
Consider $f(x,y)=x^2+y^2-1$ over $\RR$. Roots of $f$: unit circle.
\begin{itemize}
    \item $1$-dim manifold
    \item smooth
    \item irreducible
\end{itemize}
Algebraically, consider the quotient ring $R[x,y]/I$, where $I=(x^2+y^2-1)$.
\begin{itemize}
    \item transcendence degree $1$ over $\RR$.
    \item localizations are independent of choices
    \item $I$ is a prime ideal
\end{itemize}
\begin{example}
    $x^n+y^n=z^n$ over $\ZZ$. (no non-trivial solutions when $n\ge 3$) Assume $n=2$. Can identify (not a bijective correspondence) the solution sets with $\{(x,y)\in\QQ^2:x^2+y^2=1\}$. Consider the line $L_t:y=tx+1$. $L_t$ meets the circle at $(-2t/(1+t^2),(1-t^2)/(1+t^2))$. In $\QQ^2$, if $t\in \QQ$, then 
    \[t\leftrightarrow\left(\dfrac{-2t}{1+t^2},\dfrac{1-t^2}{1+t^2}\right)\]
    is a fully algebraic identification of the solution set with the base field.
\end{example}
\begin{rem}
    Care about intersections.
\end{rem}
\begin{example}
    FTA. The set of zeros of a polynomial over $\CC$ is $\{(z,y)=(z,p(z)):z\in\CC\}\cap\{(z,y):y=0\}\subseteq\CC^2$.
\end{example}
\begin{defn}
    Let $L/k$ be a field extension. We say $x\in L$ is algebraic over $k$ if there exists a non-zero $p_x\in k[z]$ s.. $p_x(x)=0$. Otherwise, $x$ is transcendental over $k$. Say $L/k$ is algebraic if all elemnts of $L$ are algebraic over $k$
\end{defn}
Recall that every field $k$ has a (unique up to iso) maximal algebraic extension $\bar k$, its algebraic closure.

\textbf{In this course, we work over an algebraically closed field of characteristic $0$.}

\subsection{The Projective Plane}
FTA predicts that every two lines in a plane intersect at a point, unless they are parallel.
\begin{defn}
    The projective plane: $\PP^2_k=\PP^2=\{(x,y,z)\in k^3\setminus\{(0,0,0)\}\}/\{(x,y,z)\sim\lambda(x,y,z),\lambda\neq 0\}$.
\end{defn}
Denote $[(x,y,z)]=(x:y:z)$. We have an inclusion $k^2\hookrightarrow\PP_k^2, (x,y)\mapsto (x:y:1)$. The points at infinity are $\{(x:y:0)\}\subseteq\PP_k^2$.

A line $ax+by-c=0$ in $k^2$ dosen't have well-defined solution set in $\PP^2$, but its homogenization $ax+by+cz=0$ does.

\begin{defn}
    A projective plane curve is
    \[\{(x:y:z)\in\PP^2\colon F(x,y,z)=0\}\]
    for some non-zero homogeneous poly $F$.
\end{defn}
If $f\in k[x,y]$, then $z^{\deg f}f(x/z,y/z)=F(x,y,z)$ is homogeneous of the same degree.
\begin{defn}
    If $C=\{f(x,y)=0\}\subseteq k^2$ and $F$ is the homogenization of $f$, we say that $\{(x:y:z)\in\PP^2:F(x,y,z)=0\}$ is the projective closure of $C$ in $\PP^2$.
\end{defn}

\section{Affine Varieties}
\begin{defn}
    Affine $n$-space over $k$ is the set $\bA_k^n=k^n$. A polynomial $f(x_1,...,x_n)\in k[x_1,...,x_n]$ is also a function $\bA^n\to k$. The zero set (vanishing locus) of a subset $S\subseteq k[x_1,...,x_n]$ is the set $Z(S)=\{P\in\bA^n:\forall f\in S,\ f(P)=0\}$. An affine algebraic set is any subset of some $\bA^n$ of the form $Z(S)$ for some $S\subseteq k[x_1,...,x_n]$.
\end{defn}
\begin{defn}
    If $f\in k[x_1,...,x_n]$ is a non-constant polynoimal, then $Z(f)$ is a hypersurface. In particular, if $f$ is linear, $Z(f)$ is a hyperplane.
\end{defn}
\begin{example}
    The twisted cubic is $\{(t,t^2,t^3)\in\bA^3:t\in k\}=Z(t-x^2,z-x^3)$.It is non-planar (not contained in any hyperplane).
\end{example}
\begin{prop}
    Let $S\subseteq k[x_1,...,x_n]$ be a set of polys. Then
    \begin{enumerate}
        \item[(i)] $Z(S)=Z((S))$, where $(S)\trianglelefteq k[x_1,...,x_n]$ is the ideal generated by $S$.
        \item[(ii)] There exists $f_1,...,f_r\in S$ s.t. $Z(S)=Z(f_1,...,f_r)$.
    \end{enumerate}
\end{prop}
\begin{proof}
    (i) is trivial. (ii) follows from $k[x_1,...,x_n]$ being Noetherian.
\end{proof}
\begin{prop}
    Affine algebraic sets satisfy
    \begin{enumerate}
        \item[(i)]$S\subseteq T\subseteq k[x_1,...,x_n]\implies Z(T)\subseteq Z(S)$.
        \item[(ii)] $\bA^n,\varnothing$ are affine algebriac sets.
        \item[(iii)] Given a collection $\{S_i\}_{i\in I}$ of subsets of $k[x_1,...,x_n]$, $\bigcap_{i\in I} Z(S_i)=Z(\bigcup_{i\in I}S)$.
        \item[(iv)] If $S,T\subseteq k[x_1,...,x_n]$ are finite, then $Z(S)\cup Z(T)=Z(ST)$.
    \end{enumerate}
\end{prop}
\begin{proof}
    (i)-(iii) clear. (iv) by direct calculation.
\end{proof}
\begin{defn}
    The Zariski topology on $\bA$ is the topology whose closed sets are affine algebraic subsets. This is indeed a topology by preceding proposition.
\end{defn}
\begin{defn}
    A distinguished open set in $\bA^n$ is any set $\bA^n\setminus Z(f)$ for a single $f$.
\end{defn}
Note that Zariski topology is very coarse. The intersection of two non-empty open sets is non-empty and dense. Will prove in ES1 that distinguished open sets form a basis of Zariski topology. (Also on ES1) The Zariski topology on a product is the the product of Zariski topology. If $X\in \bA^n$ is affine algebraic, then the subspace topology agrees with the Zariski topology on $X$.

\begin{defn}
    A topological space $X$ is irreducible if $X$ is cannot be written as $X=X_1\cup X_2$ with $X_1, X_2$ closed and proper. Otherwise, $X$ is reducible.
\end{defn}
e.g. $Z(xy)$ is reducible.
\begin{defn}
    An affine variety is an irreducible (w.r.t. Zariski topology) affine algebraic set.
\end{defn}
If $f\in k[x_1,...,x_n]$ is irreducible then $Z(f)$ is irreducible.

\section{Ideals and the Nullstellensatz}
\begin{defn}
    $X\subseteq \bA^n$. The ideal of $X$ is $I(X)=\{f\in k[x_1,...,x_n]:\forall P\in X,\ f(P)=0\}$
\end{defn}
\begin{prop}[Properties of $I(X)$ for $X$ algebraic]
    Let $X, Y$ be affine algebraic sets in $\bA^n$.
    \begin{enumerate}[(1)]
        \item If $S\subseteq k[x_1,...,x_n]$, then $S\subseteq I(Z(S))$;
        \item $X=Z(I(X))$
        \item $X=Y$ iff $I(X)=I(Y)$.
        \item $X\subseteq Y$ iff $I(Y)\subseteq I(X)$
    \end{enumerate}
\end{prop}
\begin{proof}
    (1) clear from defn. 

    (2) Clearly $X\subseteq Z(I(X))$. Conversely, write $X=Z(S)$, so $S\subseteq I(X)$, so $Z(I(X))\subseteq Z(S)=X$.

    (3) follows from (2).

    (4). If $X\subseteq Y$, then $I(Y)\subseteq I(X)$ by defn. Conversely, if $P\in X\setminus Y$, then (2) implies that $P\not\in Z(I(Y))$, so there exists $f\in I(Y)$ with $f(P)\neq 0$.
\end{proof}
\begin{prop}
    Any affine algebraic set is a finite union (unique up to ordering, ES1) of irred. affine algebraic sets (varieties).
\end{prop}
\begin{proof}
    Let $X$ be affine algebraic. Suppose $X$ is reducible (otherwise done), i.e., $X=X_1\cup X_1'$. If $X$ is not a finite union of varieties, then wlog $X_1$ is not a finite union of varieties. We can write $X_1=X_2\cup X_2'$ s.t. $X_2$ fails to be a finite union of varieties. Continue, get a descending chain of affine alg sets. By the preceding prop, get an ACC in $k[x_1,...,x_n]$, which eventually stabilizes, i.e., eventually $X_n$ is a finite union of varieties.
\end{proof}
Get maps $Z(\cdot ),\ I(\cdot )$
\[\left\{\text{affine alg subsets of }\bA^n\right\}\overset{X\leftrightarrow I(X)}{\longleftrightarrow}\left\{I\trianglelefteq k[x_1,...,x_n]\right\}\]
$I(\cdot)$ does not have full image, e.g., $(x^2)$.
\begin{prop}
    $X\subseteq\bA^n$ affine alg set. Then $X$ is irreducible iff $I(X)$ is a prime ideal.
\end{prop}
\begin{proof}
    Suppose $X$ is reducible, write $X=X_1\cup X_2$ proper closed. Then $I(X)=I(X_1)\cap I(X_2)$. By (3) of the previous proposition, there exists $f\in I(X_1)\setminus I(X_2)$ and $g\in I(X_2)\setminus I(X_1)$. Then $fg\in I(X)$ but $f,g\not\in I(X)$, so $I(X)$ is not prime.

    Conversely, if $I(X)$ is not prime, then can find $f,g\not\in I(X)$ but $fg\in I(X)$. Define $X_1=X\cap Z(f)$ and $X_2=X\cap Z(g)$. These are proper closed subsets and $X_1\cup X_2=X$, so $X$ is reducible. 
\end{proof}

\begin{thm}[Weak Nullstellensatz]
    The maximal ideals of $k[x_1,...,x_n]$ are those of the form $(x_1-a_1,x_2-a_2,...,x_n-a_n)$ for some $(a_1,...,a_n)\in k^n$.
\end{thm}
Proof postponed.
\begin{crly}[Weak Nullstellensatz]
    If $I\subsetneq k[x_1,...,x_n]$ is a proper ideal, then $Z(I)\neq\varnothing$.
\end{crly}
\begin{proof}
    Any proper ideal is contained in a maximal ideal which has the form $(x_1-a_1,...,x_n-a_n)=\mathfrak m$, so $(a_1,...,a_n)\in Z(\mathfrak m)$.
\end{proof}
\begin{defn}
    Let $I\trianglelefteq k[x_1,...,x_n]$. The radical ideal of $I$ is $\sqrt I=\{f\in k[x_1,...,x_n]:\exists m>0,\ f^m\in I\}$.
\end{defn}
Note that $I\subseteq\sqrt I$ and $Z(I)=Z(\sqrt I)$.
\begin{thm}[Hilbert's Nullstellensatz]
    Let $J\trianglelefteq k[x_1,...,x_n]$. Then $\sqrt J=I(Z(J))$.
\end{thm}
\begin{proof}
    By defn, $\sqrt J\subseteq I(Z(J))$.

    Write $J=(f_1,...,f_r)$ and let $g\in I(Z(J))$. Define another ideal $\tilde J=(f_1,...,f_r,x_{n+1}g(x_1,...,x_n)-1)\trianglelefteq k[x_1,...,x_{n+1}]$. If $\tilde P\in Z(\tilde J)$, then the projection $P$ to the first $n$ coords is in $Z(f_i)$ for all $1\le i\le r$, so $g(P)=0$. Contradicting $x_{n+1}g-1=0$, so $Z(\tilde J)=\varnothing$, so $1\in \tilde J$ by weak Nullstellensatz, so $\exists h_1,...,h_{n+1}\in k[x_1,...,x_{r+1}]$ with $\sum_{i=1}^r h_if_i+h_{r+1}(x_{n+1}g-1)=1$. On the set where $x_{n+1}g=1$, we have $\sum_{i=1}^r h(x_1,...,x_n,1/g(x_1,...,x_n))g(x_1,...,x_n)=1$. Clear denominators by a sufficiently high power of $g$. Get
    \[\sum_{i=1}^rh_i'(x_1,...,x_n)f_i(x_1,...,x_n)=g(x_1,...,x_n)^N\]
    so $g\in\sqrt J$.
\end{proof}

\section{Coordinate Rings and Morphisms}
\begin{crly}
    There is a bijective correspondence
    \begin{align*}\{\text{affine alg subsets of $\bA^n$}\}&\longleftrightarrow\{\text{radical ideals in }k[x_1,...,x_n]\}\\
    & X\rightarrow I(X)\\
    &Z(J)\leftarrow J
    \end{align*}
\end{crly}
\begin{proof}
    $Z(I(X))=X$ and $I(Z(J))=\sqrt J$.
\end{proof}
This specializes to 
\[\{\text{affine varieties in }\bA^n \}\leftrightarrow\{\text{prime ideals of }k[x_1,...,x_n]\}\]

\begin{defn}
    $X\subseteq\bA^n$ affine algebraic set. The coordinate ring on $X$ (the ring of regular functions on $X$) is $A(X)=k[x_1,...,x_n]/I(X)$. [Alternative notations include $\mathcal O_X,\mathcal O(X), k[X]$,...]
\end{defn}
\begin{rem}
    Have an algebraic description of evaluation of $P\in X$. Write $P=(p_1,...,p_n)$, then
    \[ev_P=k[x_1,...,x_n]\to k[x_1,...,x_n]/(x_1-p_1,...,x_n-p_n)\overset\cong\to k\]
    Call $\mathfrak m_P=(x_1-p_1,...,x_n-p_n)$, then $\mathfrak m_P=I(\{P\})$. For $P\in X\in\bA^n$, $I(X)\subseteq\mathfrak m_P$, and the image of $\mathfrak m_P$ in $A(X)$ is the ideal of regular functions on $X$ which vanish at $P$.
\end{rem}
\begin{defn}
    $X\subseteq \bA^n$, $Y\subseteq\bA^m$ affine alg. sets. A morphism (regular map) from $X$ to $Y$ is $f:X\to Y$ s.t. $\exists p_1,...,p_m\in A(X)$ with $f(P)=(p_1(P),...,p_m(P))$ for all $P\in X$. Denote the set of morphisms $X\to Y$ by $\operatorname{Mor}(X,Y)$. In particular, if $Y=\bA^1$, then $\operatorname{Mor}(X,\bA^1)=A(X)$.
\end{defn}
\begin{defn}
    Let $f:X\to Y$ be a morphism. The pullback of $f$ is $f^\ast:A(Y)\to A(X)$, $g\mapsto g\circ f$. 
\end{defn}
\begin{enumerate}[1)]
    \item Morphisms are cts w.r.t. Zariski topology. If $Z=Z(g_1,...,g_r)\subseteq Y$, then
    \[f^{-1}(Z)=\bigcap_i f^{-1}(Z(g_i))=\bigcap_i Z(f^\ast g)=Z(f^\ast g_1,...,f^\ast g_r)\]
    \item Morphisms need not be closed, e.g., $\pi_x:\bA^2\to\bA^1$ sends $Z(xy-1)$ to $\bA^1\setminus\{0\}$.
    \item Functorial.
    \item Pullback $f^\ast:A(Y)\to A(X)$ is a ring hom, which restricts to the identity on $k$, i.e., $f^\ast$ is a $k$-algebra hom.
\end{enumerate}
\begin{example}
\begin{enumerate}[1)]
    \item Let $n\ge m$, $\pi:\bA^n\to\bA^m$ projection on to the first $m$ coords. Then $\pi$ is a morphism and $\pi^\ast:k[y_1,...,y_m]\to k[x_1,...,x_n]$ is given by $y_i\to y_i\circ \pi=x_i$, i.e., this map is the natural inclusion.
    \item $f:\bA^1\to Z(y-x^2)\subseteq\bA^2$, $t\mapsto (t,t^2)$. Then $f^\ast:k[x,y]/(y-x^2)\to k[t]$, $x\mapsto t,\ y\mapsto t^2$, is an iso. More gnerally, the affine $d$-Veronese embedding of $\bA^1$ is the image of $t\mapsto (t,t^2,...,t^d)\subseteq\bA^d$ (degree $d$ Veronese curve).
\end{enumerate}
\end{example}
\begin{thm}
    Let $X\subseteq\bA^n$, $Y\subseteq\bA^m$ be affine alg. sets. Then $f\mapsto f^\ast$ defines a bijection $\operatorname{Mor}(X, Y)\to \Hom_k(A(Y),A(X))$
\end{thm}
\begin{proof}
    Let $x_1,...,x_n$, $y_1,...,y_n$ be coords on $\bA^n$, $\bA^m$ respectively. A morphism $f:X\to Y$ described by $P\mapsto (f_1(P),...,f_m(P))$, $f_i\in A(X)$. Then $f^\ast y_i=f_i$ by defn, so $f$ can be recovered from $f^\ast$, i.e., the map is inj. 
    
    If $\lambda:A(Y)\to A(X)$ is a $k$-algebra hom. Define $f_i=\lambda(y_i)$ and $f:X\to \bA^m$ by $f=(f_1,...,f_m)$.\\
    \textbf{Claim: $f(X)\subseteq Y=Z(I(Y))$, i.e., $g\circ f$ vanishes for all $P\in X$ and all $g\in I(Y)$} We have $g\circ f=g(f_1,...,f_m)=g(\lambda(g_1),...,\lambda(g_m))=\lambda(g)$, so this is $0$ if $g\in I(Y)$. Note that $\lambda=f^\ast$, since $\lambda(y_i)=f^\ast(y_i)$.
\end{proof}
\begin{defn}
    A morphism $f:X\to Y$ is an isomorphism if $f$ is bijective and $f^{-1}$ is a morphism.
\end{defn}
Note that being bijective does not imply being an iso, e.g., $X=\bA^1$, $Y=Z(y^2-x^3)\subseteq\bA^2$. $f:X\to Y,\ t\mapsto (t^2,t^3)$ is a bijective morphism. If $f^{-1}$ is a morphism, then $\exists fg\in k[x,y]$ s.t. $g(t^2,t^3)=t$. Contradiction.
\begin{crly}
    $f:X\to Y$ is an iso iff $f^\ast$ is an iso.
\end{crly}
This is affine.  Will see that $\hat\CC$ (Riemann sphere) is a proj. variety. If $f$ is a fn on $\hat\CC$ which looks like a finite-valued poly everywhere, then it's constant by Liouville.

\section{Proof of Nullstellensatz}
\begin{defn}
    $S$ is a finitely generated $R$-algebra if $\exists s_1,...,s_n\in S$ s.t. $S=R[s_1,...,s_n]$. Say $S$ is integral over $R$ if $\exists$ monic poly $f\in R[x]$ with $f(s)=0$.
\end{defn}
\begin{prop}
    Let $s\in S$, TFAE,
    \begin{enumerate}[1)]
        \item $s$ is integral over $R$,
        \item $R[s]$ is a f.g. $R$-mod
        \item $\exists$ f.g. $R$-mod $R'$ which is a subring of $S$ s.t. $R[s]\subseteq R'$.
    \end{enumerate}
\end{prop}
\begin{proof}
    1)$\Rightarrow$2): Take a monic poly $f$ which annihilates $s$, then $R[s]$ is generated by $1,s,...,s^{\deg (f)-1}$ as $R$-mod.

    2)$\Rightarrow$3): Take $R'=R[s]$.

    3)$\Rightarrow$1): Write $R'=Rv_1+\cdots+Rv_n$. Consider the multiplication by $s$. Let $A$ be the matrix of this $R$-lienar map. Then $Av=sv$, so $(A-s\id)v=0$, so $\det (A-s\id)=0$ and $\det (A-s\id)$ is monic over $R$, so $s$ is integral over $R$.
\end{proof}
\begin{crly}
    If $R\subseteq S$ are rings and $S$ is f.g. as an $R$-alg and $R$-mod, then all elements of $S$ are integral over $R$.
\end{crly}
\begin{lem}[Zariski's lemma]
    Let $K/k$ be a field extension. If $K$ is a f.g. $k$-algebra, then $K$ is a f.g. $k$-module.
\end{lem}
Now prove Weak Nullstellensatz assuming Zariski's lemma.
\begin{proof}[Proof of Weak Nullstellensatz]
    Note that $(x_1-a_i,...,x_n-a_n)$ is maximal in $k[x_1,...,x_n]$.

    Suppose $\mathfrak m\trianglelefteq k[x_1,...,x_n]$ is maximal. so $k\hookrightarrow k[x_1,...,x_n]\to k[x_1,...,x_n]/\mathfrak m=K$, so $K/k$ is a field extension. $K$ is f.g. as $k$-algebra, so f.g. as $k$-mod (Zariski), so the extension is finite. But $k$ is alg-closed, so the extension is trivial. $\phi$ is surj. Define $a_i=\phi^{-1}(x_i\mod \mathfrak m)$, so $x_i-a_i\in\mathfrak m$. Then $\mathfrak m=(x_1-a_1,...,x_n-a_n)$ by maximality of the other.
\end{proof}
\begin{prop}
    Suppose $k\subseteq k(s)$ is a field extension and $s$ is transcendental over $k$. Then
    \begin{enumerate}[1)]
        \item $k[s]$ is a UFD, and contains an infinite set of pairwise coprime elements.
        \item If $t\in k(s)$ is integral over $k[s]$, then $t\in k[s]$.
    \end{enumerate}
\end{prop}
\begin{proof}
    1) The map $k[x]\to k[s]$ is an iso. If we can only find a finite set of monic irreducible pairwise coprimes $p_1,...,p_k$, then $p_1\cdots p_k+1$ is pairwise coprime to everything on the list.

    2) Write $t=p(s)/q(s)$ and suppose $\exists f_0,...,f_{n-1}\in k[s]$ s.t. $(p/q)^n+f_{n-1}(p/q)^{n-1}+\cdots+f_0=0$. If $p,q$ are coprime, then $q$ is const, i.e., $t\in k[s]$.
\end{proof}
\begin{proof}[Proof of Zariski's lemma]
    Induction on the number of generators of $K$ as a $k$-alg.
    Base case: $K$ is generated by $s$. $s^{-1}\in k[s]$, so $s$ is alg over $k$ so integral over $k$, so $K$ is f.g. as a $k$-mod. Suppose the lemma holds for $<n$ generators. Let $K=k[s_1,...,s_n]$. Apply inductive hypothesis to $k(s_1)$, so $K$ is a f.g. $K(s_1)$-mod. If $s_1$ is alg, then done. Suppose $s_1$ is transcendental over $k$. Note that each $s_i$, $2\le i\le n$ is alg over $k(s_1)$, so $\exists f_{ij}\in k(s_1)$ s.t. $s_i^{n_i}+\cdots+f_{i,n-1}s_i^{n_{i}-1}+\cdots+f_{i,0}=0$. There exists $f\in k[s_1]$ s.t. $(fs_i)^{n_i}+ff_{i,n-1}(fs_i)^{n-1}+\cdots+f^{n_i}f_0=0$, so $fs_i$ is integral over $k[s_1]$. If $h\in k(s_1)\subseteq K=k[x_1,...,x_n]$, then $\exists N$ s.t. $f^Nh\in k[s_1][fs_2,...,fs_n]$, so $f^Nh$ is integral over $k[s_1]$. Since $k[s_1]$ is integrally closed, $f^Nh\in k[s_1]$. This holds for all $h$, so choose $h=1/t$, $t$ is coprime to $f$ by the previous prop, so contradiction. So $s_1$ is algebraic.
\end{proof}

\begin{defn}
    Let $X\subseteq\bA^n$ be an affine variety. The function field of $X$, $k(X)$ is the fraction field of $A(X)$. Its elements are called rational functions on $X$ ($k=\CC$: meromorphic). If $\varphi\in k(X)$ can be represented by $f/g$, with $g(P)\neq 0$ for $P\in X$, then we say $\varphi$ is regular at $P$.
\end{defn}
\begin{defn}
    If $\mathfrak p$ is a prime ideal in an ID $R$ with field of fractions $K$. The localization of $R$ at $\mathfrak p$ is $R_{\mathfrak p}=\{a/b\in K:b\not\in\mathfrak p\}$.
\end{defn}
\begin{defn}
    A local ring is a ring with a unique maximal ideal
\end{defn}
\begin{defn}
    Let $X$ be an affine variety, and $x\in X$. The local ring of $X$ at $x$ is $\mathcal O_{X,x}=\{\varphi=f/g: f,g\in A(X), g(x)\neq 0\}$. This is the localization of $A(X)$ at the prime ideal $\{f\in A(X):f(x)=0\}$. (the image of $\mathfrak m_x$)
\end{defn}
\begin{prop}
    Let $X$ be an affine variety, $x\in X$. $\mathcal O_{X,x}$ has a unique maximal ideal $\mathfrak m_{x}=\{\varphi\in\mathcal O_{X,x}:\varphi(x)=0\}$.
\end{prop}
\begin{proof}
    $\varphi=f/g\in \mathcal O_{X,x}$ has multiplicative inverse iff $f(x)\neq 0$ iff $\varphi\not\in\mathfrak m_x$. Any proper ideal of $\mathcal O_{X,x}$ is contained in $\mathfrak m_x$. 
\end{proof}
\begin{lem}
    If $R$ is a Neotherian ID and $\mathfrak p$ is a prime ideal of $R$, then $R_{\mathfrak p}$ is Noetherian.
\end{lem}
\begin{proof}
    Given an ACC in $R_{\mathfrak p}$. Take the preimage under the projection map. Get an ACC in $R$ which stabilizes. Argue by contradiction.
\end{proof}
\begin{defn}
    $X$ affine variety. For $U\subseteq X$ open, $\mathcal O_X(U)=\bigcap_{x\in U}\mathcal O_{X,x}$ is the ring of regular functions on $U$.
\end{defn}
\begin{lem}
    $\mathcal O_X(X)=A(X)$
\end{lem}
\begin{proof}
    ``$\supseteq$'' clear.

    ``$\subseteq$'': If $\varphi\in\bigcap_x\mathcal O_{X,x}$. Define $I_{\varphi}=\{h\in A(X):h\varphi\in A(X)\}$. If $I_\varphi$ is proper, then it is contained in a maximal ideal. By weak Nullstellensatz, $\exists P\in X$ s.t. $h(P)=0$ for all $h\in I_{\varphi}$. But $\varphi$ is regular at $P$, i.e., $\varphi=f/g$, $g(P)\neq 0$. Contradiction. So $1\in I_\varphi$.
\end{proof}

\begin{rem}
    It can happen that $\varphi$ requires more than one representation as fractions, e.g. in $\bA^4$, $X=Z(xw-yz)$. Let $\varphi=x/y\in k(X)$ regular on $X\cap \{y=0\}$. Also $\varphi=z/w$ on $X$, which is regular for $w\neq 0$, so $\varphi$ is regular on $(X\cap\{y\neq 0\})\cup (X\cap \{w\neq 0\})$.
\end{rem}

\begin{prop}
    Let $f:X\to Y$ be a cts (in Zariski topology) map of affine varieties. Then TFAE,
    \begin{enumerate}[1)]
        \item $f$ is a morphism.
        \item for all $x\in X$ and all $\varphi\in\mathcal O_{Y,f(x)}$, $f^\ast\varphi\in\mathcal O_{X,x}$
    \end{enumerate}
\end{prop}
\begin{proof}
    If $f$ is a morphism and $\varphi=g/h$ where $h(f(x))\neq 0$, then $f^\ast=(g\circ f)/(h\circ f)$ and $h\circ f\neq 0$ at $x$, so $f^\ast\varphi\in\mathcal O_{X,x}$. 

    Conversely, if $\varphi\mapsto\varphi\circ f$ induces a map $\mathcal O_{Y,f(x)}\to \mathcal O_{X,x}$ for all $x\in X$, then we have
    \[f^\ast:\bigcap_{f(x)\in f(X)\subseteq Y}\mathcal O_{Y,f(x)}\to\bigcap_{x\in X}\mathcal O_{X,x}=A(X)\]
    Restrict to $A(Y)$, get $f^\ast:A(Y)\to A(X)$. Evaluating $f^\ast$ at each coordinate $y_1,...,y_n$ gives a morphism.
\end{proof}

\section{Projective Varieties}

Consider the projective $n$-space $\PP^n=\PP^n_k$.
Have $\PP^n=\bA^n\cup\PP^{n-1}$. Call pts in $\PP^{n-1}$ in this decomposition ``pts at infinity''.

We define $U_i=\{[x_0:\cdots:x_n]\in\PP^n:x_i\neq 0\}$ for $0\le i\le n$ (standard affine patch of $\PP^n$), and $\PP^n\setminus U_i$ is a coordinate hyperplane. 

\begin{prop}
    With the quotient topology, $\CC P^n$ is compact.
\end{prop}
\begin{defn}
    The Zariski topology on $\PP^n$ is the quotient topology induced by the projection $\bA^{n+1}\setminus\{0\}\to \PP^n$.
\end{defn}
\begin{example}
    $n=1$. (ES1) Zariski closed subsets in $k^2$ are $\varnothing$, $k^2$, finite unions of curves and points. So $\varnothing,\PP^1$ and the curves which contain lines through $0$ are lines through $0$ (cf. ES1), so get finite sets too.
\end{example}
\begin{defn}
    A polynomial $F\in k[x_0,...,x_n]$ is homogeneous if all its monomials have the same degree.
\end{defn}
\begin{lem}
    Let $F$ be a homogeneous poly of degree $d$ in $k[x_0,...,x_n]$. Then $Z(F)$ is a well-defined subset of $\PP^n$.
\end{lem}
\begin{proof}
    
\end{proof}
\begin{defn}
    An algebraic set in $\PP^n$ is any set of the form $Z(S)$, where $S$ is a collection of homogeneous polys (not necessarily of the same degree).
\end{defn}
Can define a topology on $\PP^n$ where closed sets are algebraic sets. (Q1ES2) This coincides with the Zariski topology on $\PP^n$.
\begin{defn}
    An ideal $I\trianglelefteq k[x_0,...,x_n]$ is homogeneous if it is  generated by homogeneous polys (not necessarily of the same degree).
\end{defn}
Note that $(x,x^3+y^2)\trianglelefteq k[x,y]$ is an ideal generated by non-homogeneous polys, but can rewrite it as $(x,y^2)$ which is homogeneous.
\begin{lem}
    Let $I\trianglelefteq k[x_0,...,x_n]$. Then TFAE,
    \begin{enumerate}[1)]
        \item $I$ is homogeneous
        \item If $f\in I$, then the degree $d$ part $f_d\in I$, where $f_d$ is the sum of all degree $d$ monomials of $f$.
    \end{enumerate}
\end{lem}
\begin{proof}
    1)$\Rightarrow$2): If $I$ is homogeneous, then $I=(f_1,...,f_k)$ s.t. $\deg f_i=d_i$ and $f_i$ homogeneous. Given $g\in I$, decompose $g$ as a $k[x_0,...,x_n]$-linear combination of $f_i$ and write down the degree $d$ part of $g$.

    2)$\Rightarrow$1): If $f_1,...,f_s$ generate $I$, then $\bigcup_{i=1}^s\bigcup_{d\ge 0}\{(f_i)_d\}$ generate $I$ and are all homogeneous. 
\end{proof}

As in the affine case, we have
\begin{prop}
    For homogeneous ideals $I_j\trianglelefteq k[x_0,...,x_n]$ we have 
    \begin{enumerate}[1)]
        \item $I_1\subseteq I_2\implies Z(I_1)\supseteq Z(I_2)$;
        \item $\bigcap Z(I_j)=Z(\bigcup I_j)$
        \item $Z(I_1)\cup Z(I_2)=Z(I_1I_2)$.
    \end{enumerate}
\end{prop}
\begin{defn}
    An algebraic set in $\PP^n$ is $Z(I)$ for any homogeneous ideal $I$. A projective variety is any irreducible algebraic set in $\PP^n$.
\end{defn}
\begin{example}
    Suppose $f_1,...,f_r$ are linear homogeneous in $k[x_0,...,x_n]$. Each $Z(f_i)\subseteq k^{n+1}$ is a vector subspace, so $Z(f_1,...,f_r)\subseteq k^{n+1}$ is too. Then $Z(f_1,...,f_r)\subseteq\PP^n$ is a projective linear space in $\PP^n$. E.g., $Z(ax+by+cz)\subsetneq\PP^2$. This is parametrized by a projective line, for example, if $a\neq 0$ then $(b:a:0)$ and $(-c:-:a)$ are distinct pts on $Z(ax+by+cz)$.  The map $(t,u)\mapsto (bt-cu:-at:au)$ identifies $\PP^1$ as this projective linear space.
\end{example}
\begin{example}
    Any element of $GL_{n+1}(k)$ induces a well-defined map on $\PP^n$. The action has kernel $\{\lambda I:\lambda\in k^\ast\}$. (cf. ES2)
\end{example}

\textbf{Varieties do not need to be irreducible.}
\begin{defn}
    If $F\in k[x_0,...,x_n]$ is a non-const homogeneous poly, then $Z(F)\subseteq\PP^n$ is called a hypersurface in $\PP^n$.
\end{defn}
\begin{example}
    Segre surface $\Sigma_{1,1}=Z(x_0x_3-x_1x_2)\subseteq\PP^3$. Consider the function of sets
    $\PP^1\times\PP^1\to\PP^3,\ ((t_0:t_1),(u_0:u_1))\mapsto (t_0u_0:t_0u_1:t_1u_0:t_1u_1)$. This defines a bijection $\PP^1\times\PP^1\to\Sigma_{1,1}$. This identification is the defn of $\PP^1\times\PP^1$ as a projective variety.
\end{example}
\begin{example}
    (Rational normal curve of degree $n$ in $\PP^n$) Consider $\PP^1\to\PP^n,\ (t:u)\mapsto (t^n:t^{n-1}u:\cdots:u^n)$ (bijective to its image). When $n=3$ this is the (projective) twisted cubic. It's the zero locus of $3$ quadrics in $k[x_0,...,x_3]$ and cannot be written as $Z(f_1,f_2)$ (ES2).
\end{example}

(From projective to affine) Given a proj. variety $V=Z(I)\subseteq\PP^n$. Define $I_0=\{F(1,x_1,...,x_n):F\in I\}$ (dehomogenization) in $k[x_1,...,x_n]$ with $V_0=Z(I)$. Then $V_0=C\cap U_0$, where $U_0$ is the standard patch with $x_0\neq0$.

(From affine to proj) If $V$ is an affine variety, then $V\subseteq \PP^n$ via an inclusion. This is not necessarily closed in $\PP^n$. Can take the closure in Zariski topology.
\begin{defn}
    If $f\in k[x_1,..,x_n]$, then the homogenization of $f$ is $F=x_0^{\deg f}f(\frac{x_1}{x_0},\ldots,\frac{x_n}{x_0})$.
\end{defn}
If $V=Z(I)\subseteq \bA^n$, then define $I^\ast$ to be the ideal generated by all homogenization of elements of $I$. Write $V^\ast=Z(I^\ast)\subseteq\PP^n$. Under the standard inclusion of the patch $U_0$, $V^\ast\cap U_0=V$. Call $V^\ast$ the projective closure of $V$. It is the minimal projective variety containing $V$, i.e., if $V\subseteq Y=Z((F_1,...,F_s))\subseteq\PP^n$, then each dehomogenization $f_i$ of $F_i$ vanishes on $V$, so each $f_i$ is in $I(V)$, so $F_i\in I^\ast$, so $I(Y)\subseteq I(V^\ast)$,so $V^\ast=Z(I(V^\ast))\subseteq Z(I(Y))=Y$.
\begin{example}
    The affine Fermat curve $Z(x^n+y^n-1)$ has homogenization $x^n+y^n=z^n$ which gives a curve in $\PP^2$ (the projective closure). The points at infinitey ($z=0$) are precisely  $(1:\zeta:0),\ \zeta^n=-1$. 
\end{example}
\begin{example}
    Consider $V=Z(x_0x_2-x_1^2)\subseteq\PP^2$. Dehomogenize w.r.t. each variable, get affine pieces $Z(x_2-x_1^2)$,  $(x_0x_2-1)$, $Z(x_0-x_1^2)$.
\end{example}
\begin{example}
    Let $F$ be a homogeneous poly of deg $2$ in $k[x_0,....,x_n]$. $Q=Z(F)$ is a quadric hypersurface. Can choose coordinates so that this is identified with $Z(x_0^2+\cdots+x_r^2)$, where $r+1$ is the rank of the quadratic form.
\end{example}
\subsection{Projective Nullstellensatz}
\begin{defn}
    Let $X\subseteq\PP^n$ Define the ideal of $X$ to be $I(X)$, generated by homogeneous polys which vanish on $X$. The affine cone over $X$ is $C(X)=\{(x_0,...,x_n)\in\bA^{n+1}:(x_0:\cdots:x_n)\in X\}\cup\{0\}\subseteq\bA^{n+1}$.
\end{defn}
\begin{prop}[Projective Nullstellensatz]\
    \begin{enumerate}[(1)]
        \item If $X_1\subseteq X_2\subseteq\PP^n$ are algebraic, then $I(X_2)\subseteq I(X_1)$
        \item  If $X\subseteq\PP^n$ is algebraic, then $Z(I(X))=X$
        \item For any homogeneous ideal $J\trianglelefteq k[x_0,...,x_n]$ and $Z(J)\neq\varnothing$, then $I(Z(J))=\sqrt{J}$.
        \item If $J$ is a homogeneous ideal with $Z(J)=\varnothing$, then either $J=(1)$ or $J(x_0,...,x_n)$.
    \end{enumerate}
\end{prop}
\begin{proof}
    (1) and (2) are the same as affine cases. 

    (3): Given such $J$, have $C(Z(J))\neq\varnothing$. By affine Nullstellensatz,  $I(Z(J))=\sqrt{J}$.

    (4): $Z(J)$ viewed in $\bA^{n+1}$ is either empty or $\{0\}$. By affine Nullstellensatz, $\sqrt{J}$ contains $x_0,...,x_n$.
\end{proof}

\begin{defn}
    If $V\subseteq\PP^n$ is a projective variety and $W\subseteq  V$ is also a projective variety, then we say that $W$ is a (closed) subvariety of $V$, and $V\setminus W$ is an open subvariety of $V$. Open subvarieties of projective varieties (including $\varnothing$) are quasi-projective varieties.
\end{defn}
\begin{prop}\
    \begin{enumerate}[(i)]
        \item Every projective variety is a finite union of irreducible proj. varieties,
        \item a projective variety $X$ is irreducible iff $I(X)$ is prime.
    \end{enumerate}
\end{prop}
\begin{proof}
    (1) identical to the affine argument. (2) If $X$ is reducible, then $\pi:C(X)\setminus\{0\}\to X$ shows that $C(X)$ is reducible, so $I(X)$ is not prime (by the affine version). If $I(X)$ is not prime, so $C(X)=V_1\cup V_2$, closed proper subsets. Define $Z_i=Z(f(\lambda x_0,...,\lambda x_n):f\in I(V_i),\lambda\in k^\times)$ (lines through $0$ in $V_i$). Note that $Z_i\subseteq V_i$, so proper. Since closet subsets of $\bA^1$ are $\bA^1,\varnothing,$ finite sets. Each line is in either $Z_1$ or $Z_2$, so $C(X)=Z_1\cup Z_2$. Apply $\pi$, $X$ is reducible.
\end{proof}
A subset $S\subseteq X$ of an algebraic set $X$ is Zariski dense iff any poly $f$ vanishing on $S$ vanishes on $X$.
\begin{prop}
    Let $X\subseteq\PP^n$ be irred proj. variety, $Y\subsetneq X$ closed subvariety. Then $X\setminus Y$ is Zariski dense in $X$.
\end{prop}
\begin{proof}
    Let $f\in I(X\setminus Y)$. By projective Nullstellensatz, $I(X)\subsetneq I(Y)$, so find $g\in I(Y)\setminus I(X)$, so $fg\in I(X)$ and $g\not\in I(X)$, so $f\in I(X)$ ($X$ is irred.).  
\end{proof}
\subsection{Functions on Projective Space}
\begin{defn}
    If $X\subseteq\PP^n$ be an irred projective variety. The function field (field of rational functions) of $X$ is $k(X)=\{f/g:f,g,h\in k[x_0,...,x_n]\text{ homogeneous of equal degree},\ g\notin I(X)\}/\sim$, where $f_1/g_1\sim f_2/g_2$ iff $f_1g_2-f_2g_1\in I(X)$.
\end{defn}
Can check that $\sim$ is an equiv relation.
\begin{prop}
    Let $X\subseteq\PP^n$ be a projective variety and $X\subsetneq\{x_0=0\}$ (so that $X_0=X\cap U_0$) is non-empty and open. Then $k(X)=k(X_0)$.
\end{prop}
\begin{proof}
    The map $f/g\mapsto f(1,y,...,y_n)/g(1,y,...,y_n)$ provides an isomorphism.
\end{proof}
\begin{defn}
    Let $X\subseteq\PP^n$ be an irred projective variety and $\varphi\in k(X)$, and $P\in X$. Then $\varphi$ is regular at $P$ if $\exists$ representative $f/g$ of $\varphi$ with $g(P)\neq 0$. Then the local ring at $P$ is $\mathcal O_{X,P}=\{\varphi\in k(X):\varphi\text{ regular at }P\}$. 
\end{defn}
\begin{prop}
    Suppose $X\subseteq \PP^n$ not contained in $\{x_0=0\}$. Let $P\in X\cap U_0$, where $U_0$ is the first affine patch. Then $\mathcal O_{X,P}=\mathcal O_{X_0,P}$.
\end{prop}
\begin{proof}
    Normalize the first coord, cf. the last proof.
\end{proof}
\begin{example}
    If $k=\CC$ and consider $\PP^1_{\CC}$ (Riemann sphere). If $\varphi\in \CC(\PP^1_\CC)$ is regular at all points, then $\varphi$ gives a holomorphic map $\CC_\infty\to\CC$ which is necessarily constant by Liouville.
\end{example}
\begin{prop}
    There are no non-constant rational functions on $\PP^1$ which are regular at all points.
\end{prop}
\begin{proof}
    If $\varphi\in k(\PP^1)$ with representative $f(x_0,x_1)/g(x_0,x_1)$, with no common factors of degree $d$, then $f(1,x_1),g(1,x_1)$ have no common root. [If $x_1-\alpha$ is a factor of $g(1,x_1)$, then $x_1-\alpha x_0$ is a factor of $g$. If $\alpha$ is a root of $g$, and $\varphi=h/k$, then $kf-hg=0$, so $k(1,x_1)f(1,x_1)=h(1,x_1)g(1,x_1)$. Since $f(1,\alpha)\neq 0$, conclude that $k(1,\alpha)=0$, but now $\varphi$ fails to be regular at $(1,\alpha)$.] So $g(1,x_1)$ has no roots, so $g(x_0,x_1)=cx_0^d$ for some constant $c$. Symmetric argument applies to $x_0$, so $g(x_0,x_1)=c'x_1^d$, so $d=0$, so $\varphi$ is constant.
\end{proof}
\begin{crly}
    $\PP^n$ has no non-constant rational functions which are regular everywhere.
\end{crly}
\begin{proof}
    If $\varphi\in k(\PP^n)$ is non-constant, then find $P,Q\in\PP^n$ s.t. $\varphi(P)\neq\varphi(Q)$. Restrict to the projective line $L$ connecting $P,Q$. Then apply the preceding proposition to get a contradiction.
\end{proof}
\subsection{Maps Between Projective Varieties}
Suppose $F_0,...,F_m\in k[x_0,...,x_n]$ are homogeneous of the same degree. Then $F=(F(x_0,...,x_n),...,F(x_0,...,x_n)):k^{n+1}\to k^{m+1}$. This induces a well-defined map $\PP^n\setminus(\bigcap_iZ(F_i))\to\PP^m$. For any homogeneous $G\in k[x_0,...,x_n]$, $(F_0G:\cdots:F_mG)$ defines the same map on a smaller set.

\begin{defn}
    Let $X\subseteq\PP^n$ be a projective variety, $F_0,..,F_m\in k[x_0,...,x_n]$ homogeneous of the same degree, not all in $I(X)$. Then we have a well-defined map $F:X\setminus\bigcap_iZ(F_i)\to\PP^m$. We say that $F$ and $G$ (as above) determine the same rational map if they agree where both defined (a Zariski dense open subset). This is an equiv rel, and an equiv class is called a rational map on $X$, denoted $F:X\dashto\PP^m$.
\end{defn}
[Note that $F$ is equiv to $G$ can be checked by the condition $F_iG_j-G_iF_j\in I(X)$ for all $i,j$.]
\begin{defn}
    A rational map $F$ is regular at $P\in X$ if there exists representative $(F_0:\cdots:F_m)$ with $F_i(P)\neq 0$. The domain of $F$ is the set of regular points of $F_i$ and $X\setminus\text{domain}$ is the set of indeterminate points of $F$.
\end{defn}
\begin{defn}
    A rational map is said to be a morphism if it is regular at all points of $X$. In this case write $F:X\to \PP^n$ (solid arrow). If $F:X\to Y\subseteq\PP^m$ (morphism) for some algebraic subset $Y$, then $F$ is a morphism. A morphism is an isomoprhism if there exists an inverse. A rational map is birational if it has rational inverse.
\end{defn}
\begin{example}
    If $F_0,...,F_m$ are degree $1$ homogeneous polys, get a rational map from $\PP^n$ to $\PP^m$. This is a morphism iff the matrix has full rank $n+1\le m+1$.
\end{example}
\begin{example}[Projection from a point]
    Suppose $P=(0:\cdots:0:1)$. Define projection from $P$ (to the hyperplane $x_n=0$) by
    \[\pi(x_0:\cdots:x_n)=(x_0:\cdots:x_{n-1})\]
    Note that $\pi$ is not regular at $P$ but is regular at all other points. Suppose $X=Z(F)$ for some deg $d$ homogeneous poly. If $P\notin X$, the $\pi_X:X\to\PP^{n-1}$ is a morphism. Fix $a=(a_0:\cdots:a_{n-1})\in\PP^{n-1}$. $\pi^{-1}(a_0:\cdots:a_{n-1})$  intersects $X$ at $(x_0:\cdots:x_n)=(a_0\lambda:\cdots:a_{n-1}\lambda:\ast)$ iff $f(a_0,....,a_{n-1},x_n)=0$. Note that $\deg f(a_0,...,a_{n-1},x_n)\le \deg f$ in the variable $x_n$, so we have $\le\deg f$ such points.

    Consider $n=2$, $X=Z(x_0x_2-x_1^2)$, then $\pi(x_0:x_1:x_2)=(x_0:x_1)\sim(F_0:F_1)$ iff $x_1F_0+x_0F_1\in(x_0x_2-x_1^2)$, so $F_0=-x_1$, $F_1=x_2$ is an example which is defined at $P$. So $\pi|_{X}$ is an isomorphism $Z(x_0x_2-x_1^2)\simeq\PP^1$. More generally,
    \begin{defn}
        Let $n,d\ge 1$ and $N=\binom{n+d}{n}-1$. Then $\nu_d:\PP^n\to\PP^N,\ (x_0:\cdots:x_n)\mapsto (x_0^d:\cdots x_0^{d-1}x_1:x_0^{d-2}x_2:\cdots:x_n^d)$ is the degree $d$ Verenoese embedding of $\PP^n$.
    \end{defn}
    $\nu_d(\PP^n)$ is a projective variety, and $\nu_d$ is an isomorphism.
\end{example}
\begin{rem}
    A homogeneous degree $d$ poly $F$ has zero locus $Z(F)\subseteq\PP^n$ $\leftrightarrow$ the hyperplane from the coefficients of $F$ intersected with $\nu_d(\RR^n)$, i.e., $F=a_0x_0^d+a_1x_0^{d-1}x_1+\cdots+a_Nx_n^d$ $\leftrightarrow$ hyperplane $a_0z+\cdots+a_Nz_N$
\end{rem}
\begin{example}
    Let $m,n\ge 1$ and define $N=(n+1)(m+1)-1$. The Segre embedding is $\sigma_{m,n}:\PP^m\times\PP^n\to\PP^N,\ ((x_0:\cdots:x_m),(y_0:\cdots:y_n))\mapsto(x_0y_0:x_0y_1:\cdots:x_my_n)=(x_iy_j)_{0\le i\le m,0\le j\le n}$.
    \begin{prop}
        $\sigma_{m,n}$ is a bijection and the projection maps forming its inverse are morphisms. We have $\Sigma_{m,n}:=\sigma_{m,n}(\PP^m\times\PP^n)=Z(I)$, where $I$ is the ideal generated by $(z_{ij}z_{pq}-z_{iq}z_{pj})$, $0\le i,p\le m$, $0\le j,q\le n$. This ideal is prime, so $\Sigma_{m,n}$ is irreducible.
    \end{prop}
    \begin{proof}
        $\sigma_{m,n}(\PP^m\times\PP^n)\subseteq Z(I)$ clear.

        If $(a_{00}:\cdots:a_{mn})\in Z(I)$, then $\exists i,j$ s.t. $a_{ij}\neq 0$ and wlog assme $a_{ij}=1$. Define $x=(x_0,...,x_m)$ by $x_p=a_{pj}$ and $y=(y_0:\cdots y_n)$ by $y_q=a_{iq}$. The image $z_{00}:z_{01}:\cdots z_{mn}$ of $(x,y)$ satisfies $z_{pq}=x_py_q=a_{pj}a_{iq}=a_{pq}$, so the reverse inclusion also holds.

        To see that $I$ is prime, note that it is the kernel of $k[z_0,...,z_{mn}]\to k[x_0,...,x_m,y_0,...,y_n],\ z_{ij}\mapsto x_iy_j$.
    \end{proof}
\end{example}
\begin{defn}
    Let $X\subseteq\PP^m, Y\subseteq\PP^n$ be proj. varieties. The Zariski topology on $X\times Y$ is the topology given by identification of $X\times Y$ and $\sigma_{mn}(X\times Y)$.
\end{defn}
\begin{example}
    $m=n=1$. $\PP^1\times\PP^1$ is identified with $Z(z_0z_3-z_1z_2)$. Fix $P\in\PP^1$, then $P\times\PP^1$ and $\PP^1\times P$ are closed curves in $Z(z_0z_3-z_1z_2)$ isomorphic to $\PP^1$.
\end{example}

\begin{thm}
    Projective varieties are complete, i.e., if $X$ is proj, then for any variety $Y$, the second projection $X\times Y\to Y$ is closed. (Algebro-geometric version of compactness)
\end{thm}
Proof omitted

Recall that this is false for affine varieties.

\begin{crly}
    Let $f:X\to Y$ be a morphism of projective varieties. Then $f$ is a closed map.
\end{crly}
\begin{proof}
    Consider $X\to X\times Y$, $x\mapsto (x,f(x))$. Running through the defn of Segre embedding, $\id\times f$ is a closed map. $X$ is complete, so $f=\pi_2\circ (\id\times f)$ is closed.
\end{proof}
\begin{crly}
    Let $X$ be an irreducible projective variety. Then all regular functions on $X$ are constant.
\end{crly}
\begin{proof}
    If $f$ is regular on $X$, $f:X\to\bA^1\to\PP^1$ is a closed map, so $f(X)$ is a finite union of pts. So $|f(X)|=1$ by irreducibility, i.e., $f$ is constant.
\end{proof}
\subsection{Algebro-geometric Correspondence}
\begin{defn}
    A rational map $f:X\dashto Y$ of irreducible projective varieties is dominant if $f(X)$ is dense in $Y$.
\end{defn}
A rational map is birational if it has rational inverse. In this case  there exists $U$ open dense in $X$ and $V$ open dense in $Y$ s.t. $U$ is isomorphic to  $V$.
\begin{example}[Monomial maps]
    Take $A\in\operatorname{SL}_n(\ZZ)$ and define a rational map $h_A:\bA^n\to \bA^n$ by $(t_1,...,t_n)\mapsto (t_1^{a_{11}}\cdots t_n^{a_{1n}},...,t_1^{a_{n1}}\cdots t_n^{a_{nn}})$ By defn $h_A$ is a morphism on $\bA^n\setminus Z(t_1,...,t_n)$. Homogenize/extend to a map $\PP^n\to\PP^n$. This is birational with inverse $h_{A^{-1}}$.

    If $A=-I$, get $h_A(t_1,t_2)=(1/t_1,1/t_2)$. Homogenize. $h_A([t_0:t_1:t_2])=[t_1t_2:t_0t_2:t_0t_1]$. [Cremona involution]
\end{example}
\begin{rem}
    If $f:X\to Y$ and $g:Y\to Z$ are rational maps, then $g\circ f$ is a rational map if $f$ is dominant. In particular, if $\varphi:X\to Y$ (rational) is dominant and $g$ is a rational function on $Y$, then $g\circ \varphi$ is a rational function on $X$, i.e., a dominant $X\to Y$ induces $\varphi^\ast k(Y)\to k(X)$ which is injective.
\end{rem}
\begin{thm}
    Let $X,Y$ be varieties. The map $\varphi\mapsto\varphi^\ast$ is a bijective correspondence 
    \[\{\text{dominant rational maps }X\to Y\}\leftrightarrow\{k\text{-extensions }k(Y)\hookrightarrow k(X)\}\]
\end{thm}
\begin{proof}[Proof Sketch (Non-examinable)]
    Wlog, assme $X,Y$ affine. Suppose $i:k(Y)\to k(X)$. Consider generators $y_j$ of $A(Y)$. write $i(y_j)=a_j/b_j$ for $a_j,b_j\in A(X)$. These each define regular functions on $X\setminus\bigcup Z(b_j)=X'$. We obtain a map $A(Y)\to A(X')$, so there is a morphism $X'\to Y$, which is a rational map from $X$ to $Y$.
\end{proof}
\section{Singularities and Tangent Spaces}
If $Z(f)\subseteq\bA^n$, then there is a linear subspace $V$ at $P=(p_1,...,p_n)\in X$ given by
\[V=\{(x_1,...,x_n)\in\bA^n:\nabla f\cdot (x-P)=0\]
This is the ``tangent plane'' at $P$
\begin{defn}
    Let $X\subseteq\bA^n$ be an affine variety. $P\in X$ a point. The tangent space to $X$ at $P$ is 
    \[T_{X,P}=\{(v_1,...,v_n)\in k^n:\forall f\in I(X),\ \nabla f(p)\cdot v=0\}\]
\end{defn}
\begin{example}
    Consider $X=Z(x+y+z^2+xyz,x-2y+z+x^2y^2z^2)\subseteq\bA^3$ and $P=(0,0,0)$. Then $T_{X,0}=\{(v_1,v_2,v_3):v_1+v_2=0,\ v_1-2v_2+v_3=0\}$ (line)
\end{example}
\begin{example}
    $Y=Z(x+y+z^3+xyz,x+y+x^2+y^3+4z^5)$, $T_{X,0}=\{v_1+v_2=0\}$ (plane)
\end{example}
If $P=0$, then $T_{X,P}$ is generated by the linear part of elements of $I(X)$.

Suppose $X=\bA^n$. If $f(P)=0$, i.e., $f\in\mathfrak m_P$ (either in $k[x_1,....,x_n]$ or $\mathcal O_{X,P}$), define $df=\text{linear part of }f$, i.e., $a_1x_1+\cdots+a_nx_n$. The map $f\mapsto df$ can be throught of as a map $\mathfrak m_P\to T_{\bA^n,0}^\ast$ (dual) The kernel is $\mathfrak m_P^2$. There is an identification $T_{\bA^n,0}\cong\mathfrak m_P/\mathfrak m_P^2$ (cotangent space to $X$ at $P$).
[Small algebraic lemma: $\mathfrak m_P.\mathfrak m_P^2$ is the same when considered in $A(X)$ and $\mathcal O_{X,P}$]
\begin{prop}
    Let $X\subseteq\bA^n$ be an affine variety, $P\in X$. Then there is a natural iso of vect spaces $(T_{X,P})^\ast\cong\mathfrak m_P/\mathfrak m_P^2$.
\end{prop}
\begin{proof}
    $X\subseteq\bA^n$, so $T_{X,P}\subseteq k^n$. So there is a surj map $(k^n)^\ast\cong k^n\to T_{X,P}^\ast$. Wlog, translate to $P=0$. Composing the restriction map with $f\mapsto df$, we get
    \[D:M\to (k^n)^\ast\to T_{X,P}^\ast\]
    where $M=(x_1,...,x_n)$.
    $D$ is surj. Suppose $f\in\ker D$, i.e., $f\in MA(X)$ and $Df=0$. Then $df$ is a linear combination of linear parts of elements of $I(X)$, so $f\in M^2$, so this descends to the claimed iso.
\end{proof}
\begin{defn}
    Let $X\subseteq \PP^n$ be a projective variety. $P\in X$. The tangent space to $X$ at $P$ is $T_{X_i,P}$ for any affine patch $X_i$ of $X$. We write $T_{X,P}$.
\end{defn}
The previous proposition, $T_{X,P}$ is well-defined.

If $X\subseteq \PP^n$ and $Y\subseteq \PP^m$ are proj. varieties and $\varphi:X\dashto Y$ a dominant rational map, $P\in$ domain of $\varphi$. Wlog assume affine (patch containing $P$ and patch containing $\varphi(P)$)
\begin{defn}
    Write $\varphi=(f_1,...,f_m)$
    Define a linear map $d\varphi_P=T_{X,P}\to T_{Y,\varphi(P)}$ by
    \[(v_1,...,v_n)\mapsto \left(\sum_{i=1}^nv_i\frac{\partial f_1}{\partial x_i}(P),...,\sum_{i=1}^nv_i\frac{\partial f_m}{\partial x_i}(P)\right)\]
\end{defn}
 \begin{prop}
     With the notation above, 
     \begin{enumerate}[(i)]
         \item $d\varphi_P(T_{X,P})\subseteq T_{Y,\varphi(P)}$
         \item $d\varphi_P$ is linear and independent of the choice of representation of $\varphi$.
         \item If $\psi:Y\dashto Z$ dominant rational map, then $d(\psi\circ\varphi)_P=d\psi_{\varphi(P)}\circ d\varphi_P$.
         \item If $\varphi$ is birational, and $\varphi^{-1}$ is regular at $\varphi(P)$, $d\varphi_P$ is an iso.
     \end{enumerate}
 \end{prop}
 \begin{proof}
     (i) By defn, $d\varphi_P(v)\in T_{Y,\varphi(P)}$ iff $\sum_j\sum_iv_i\frac{\partial f_j}{\partial x_i}(P)\frac{\partial g}{\partial y_j}(P)=0$ for all $g\in I(Y)$. Consider the pullback on function fields. Define $h=g(f_1,...,f_m)\in I(X)$. Since $(v_1,...,v_n)\in T_{X,P}$, we have $\sum_{i}\frac{\partial h}{\partial x_i}(P)=0$. The result then follows from chain rule.

     (ii) linear by defn. Suppose $\varphi=(f_1,...,f_m)=(f_1',...,f_m')$, then $f_j-f_j'=p_j/q_j$ where $p_j\in I(X)$ and $q_j(P)\neq 0$, \[\frac{\partial (f_j-f_j')}{\partial x_i}=\frac{1}{q}\frac{\partial p_j}{\partial x_i}\]
    For $v\in T_{X,P}$, $\sum_iv_i\frac{\partial(f_j-f_j')}{\partial x_i}=0$ for each $j$.

    (iii) Chain rule;
    (iv) follows from (iii).
 \end{proof}
\begin{defn}
    Let $X$ be affine or proj. variety. \begin{enumerate}[(i)]
        \item If $X$ is irreducible, then define $\dim X=\min_{\{P\in X\}}\dim T_{X,P}$.
        \item If $X$ is irreducible, then say $P\in X$ is non-singular (or smooth) if $\dim T_{X,P}=\dim X$.
        \item If $X$ is reducible, define $\dim X$ to be the maximal dimension of its irreducible components.
        \item If $X$ is reducible and $P\in X$ lies on a single irreducible component $X_i$, then $P$ is nonsingular iff it is nonsingular in $X_i$. If $P\in X_i\cap X_j$ for distinct irreducible components, then $P$ is singular.
        \item $X$ is smooth if $X$ has no singular points.
    \end{enumerate}
\end{defn}
\[(\exists-:\tag{Owen's Signature}\]

\textit{Rational maps, function fields, local rings, tangent spaces for proj. varieties require irreducibility.}

[$X=Z(xy)$ at $0$ shows that we do require irreducibility to have a well-defined tangent space.]

If $X=Z(f)\subseteq\bA^2$ and $f$ has not linear terms and $0\in Z(f)$, then $Z(f)$ is singular at $0$, e.g. , the nodal cubic curve $Z(y^2-x^2(x+1))$ and the cuspidal cubic curve $Z(y^2-x^3)$.
\begin{rem}
    These curves are not isomorphic, but the tangent spaces don't distinguish them. We need to consider $\mathfrak m/\mathfrak m^2,\ \mathfrak m^2/\mathfrak m^3,\ \ldots$.
\end{rem}
\begin{thm}
    Let $X$ be an algebraic variety. Then the set of smooth points of $x$ is open dense in $X$.
\end{thm}
\begin{proof}
    Since the intersection set is proper closed in $X$, assume wlog $X$ is irreducible. Also assume $X$ is affine (restrict to a patch if necessary). Say $I(X)=(f_1,...,f_r)$. If $P\in X$, then $T_{X,P}$ is the zero locus of all linearizations about $P$, $\dim T_{X,P}=n-\operatorname{rank}(\partial_if_j)$. $\{P\in X:\operatorname{rank}(\partial_if_j)\le n-r\}$  is computed by $(n-r)\times(n-r)$ minors of the matrix $(\partial_if_j)$ which cannot all be in $I(X)$.
\end{proof}
\begin{crly}
    If $X,Y$ are birational varieties, then $\dim X=\dim Y$.
\end{crly}
\begin{proof}
    Restrict the birational equivalence $\varphi:X\dashto Y$ to the smooth locus.
\end{proof}

\begin{defn}
    Let $L/K$ be a field extension. We say that $x_1,...,x_n\in L$ are algebraically independent over $K$ if there is no non-trivial polynomial $p\in k[t_1,...,t_n]$ s.t. $p(x_1,...,x_n)=0$.
\end{defn}
\begin{example}
    $k(\bA^n)$ has $n$ alg indep elements.\\
    $k(Z(y^2-x(x+1)(x-1)))\cong \text{f.f. of }k[x,y]/(y^2-x(x^2-1))$. Have $x,y$ alg indep, so $\{x\}$ is alg ind set and $\{y\}$ is too, but $\{x,y\}$ is not.
\end{example}
In general if $L/K$ is f.g., generated by $x_1,...,x_m$, there exists a maximal algebraically independent subset of $\{x_1,...,x_m\}$. Wlog, assume $\{x_1,...,x_k\}$ is such a set. So $K\subseteq K(x_1,...,x_k)\subseteq L$. $K(x_1,...,x_k)/K$ is purely transcendental; $L/K(x_1,...,x_k)$ is algebraic. By primitive element theorem, can write $L=K(x_1,...,x_k)(y)$ for some $y\in L$.
\begin{defn}
    Any set $\{x_1,...,x_r\}\subseteq L$ which generate a pure transcendental extension $K(x_1,...,x_r)$ s.t. $L/K_0$ is finite is called a transcendence basis for $L/K$.
\end{defn}
\begin{defn}
    The transcendence degree of a f.g. field extension $L/K$ is the size of any transcendence basis.
\end{defn}
\begin{prop}
    Let $K=k(x_1,...,x_n)$ with $\{x_1,....,x_n\}$ alg indep over $k$, and $L/K$ a field extension. If $x_{n+1}\in L$ is algebraic over $K$, then $I=\{g\in k[t_1,...,t_{n},t]:g(x_1,...,x_{n+1})=0\}$ is a principal ideal generated by an irreducible $f\in k[t_1,...,t_{n+1}]$. If $f$ contains $t_i$, then $\{x_1,...,x_{i-1},x_{i+1},...,x_{n+1}\}$ is an alg indep set over $k$.
\end{prop}
\begin{proof}
    Note that $k[t_1,...,t_n]\subset K$ is suitable for Gauss lemma, and $K[t]$ is a PID. $I$ has a generator in $K[t]$. By Gauss, irred generator.
    If removing $x_i$ gives an alg dep set, then can find $g\in I$ which doesn't include $t_i$...
\end{proof}
\begin{crly}
    Transcendence degree is well-defined
\end{crly}
\begin{proof}
    NOtes on moodle
\end{proof}
\begin{lem}[Reduction to hypersurface]
    $X$ irred alg variety. Then $X$ is birational to a hypersurface.
\end{lem}
\begin{proof}
    Find $K_0=k(x_1,...,x_n)$ purely transcendental with $k(X)/K_0$ finite. Write $k(X)=K_0(y)$. The previous proposition says we have irred $f\in k[x_1,...,x_n][y]$ s.t. $k[x_1,...,x_n,y]\cong k[x_1,...,x_n,y]/(f)$, which is the coord ring of a hypersurface. By correspondence, $X$ is birational to hypersurface.
\end{proof}
\begin{crly}
    For any irred alg variety $X$, $\dim X$ is the transcendence degree of the function field $k(X)$. Notation: $\operatorname{trdeg}_kk(X)$.
\end{crly}
\begin{proof}
    By reduction lemma, suffices to consider hypersurfaces. If $P\in X$, then $T_{X,P}$ has dimension $n$ or $n-1$. On a Zariski open subset this dim is $n-1$. We have $k(X)=$ f.f. of $k[x_1,...,x_n]/(f)$ for some irred non const $f$ which has transcendence degree $n-1$, since $f$ is nonconst.
\end{proof}

\section{Structure of Algebraic Curves}
\begin{defn}
    A curve is a smooth projective, irreducible variety of dimension 1.
\end{defn}
(unless qualified by singular/affine/reducible)
\begin{example}
    Hypersurfaces in $\PP^2$, $Z(f)$ for $f$ homogeneous non=const deg $d$ polys in three variables. $f$ is specified by $\binom{d+2}{2}$ coeffs. Using this, can make the following identification:
    \[\{\deg\ d\text{ hypersurfaces in }\PP^2\}\leftrightarrow \PP^{\binom{d+2}{2}-1}\]
    Reducibility of $Z(f)$ is a Zariski closed condition in $\PP^{\binom{d+2}{2}-1}$. Note that $(x^d+y^d+z^d)$ is irreducible for every degree (Gauss). Get an open dense set in $\PP^{\binom{d+2}{2}-1}$ corresponds to irred hypersurfaces. In $\PP^{\binom{d+2}{2}-1}\times\PP^2$ there is a closed subvariety defined by $f(P)=0$. Vanishing of $\partial_xf,\partial_yf,\partial_zf$ are closed conditions since all curves contain smooth points, there is a Zariski closed proper subset in $\PP^{\binom{d+2}{2}-1}\times\PP^2$ which contains all pairs $(f,P)$ which have $f(P)=0$ but $f$ is reducible or $P$ is singular for $Z(f)$. A generic hypersurface in $\PP^2$ is a curve, e.g., $Z(x^d+y^d+z^d)$ is a curve in $\PP^2$.
\end{example}
\begin{rem}
    (Euler's homogeneous identity) If $f$ is homogeneous of deg $d$ in $n$ variables, then $F(x_1,....,x_n)\deg F=\sum_{i=1}^nx_i\partial_{x_i}F(x_1,...,x_n)$. This is an identity of polys. (Suffices to check monomials)
\end{rem}
\begin{prop}
    Let $C$ be a curve, $D\subseteq C$ a proper closed subvariety. Then $D$ is a finite union of points.
\end{prop}
\begin{proof}
    Wlog, $C$ is affine, $D$ is irreducible. Have $I(C)\subsetneq I(D)$. So the inclusion induces a surjective hom $\varphi^\ast:A(C)\to A(D)$. If $D$ is not a point, then Nullstellensatz implies $A(D)\supsetneq k$. $k$ is alg closed, so $A(D)$ contains a transcendental element (over $k$). Clear denominators and call the resulting elt $t$. There exists $x,y\in A(C)$ s.t. $\varphi^\ast(x)=1$ and $\varphi^\ast(y)=t$, so $x,y$ are algebraically indep in $A(C)$ and hence in $k(C)$. Contradiction as $\dim C=1$.
\end{proof}
\begin{thm}
    If $P\in C$ is a smooth point of a irred proj. dim $1$ (not necessarily smooth) variety, then the ideal $\mathfrak m_P\trianglelefteq \mathcal O_P$ is a principal ideal.
\end{thm}
\begin{lem}[Nakayama's lemma]
    Let $R$ be a ring, $M$ a f.g. $R$-module. Let $J\trianglelefteq R$ be an ideal. \begin{enumerate}[(i)]
        \item If $JM=M$, then $\exists r\in J$ s.t. $(1+r)M=0$.
        \item If $N\subseteq M$ is a submodule s.t. $JM+N=M$, then $\exists r\in J$ s.t. $(1+r)M\subseteq N$.
    \end{enumerate}
\end{lem}
\begin{proof}
    (i): Write $M=y_1R_1+\cdots+y_nR$, $y_i\in M=JM$. Write $y_i=\sum_jx_{ij}y_j$, $x_{ij}\in J$. Consider the matrix $X=(x_{ij})$ so that $(I-X)y_i=0$ for all $i$. Multiply by adjugate, get $\det(I-X)y_i=0$ for all $i$. Note that $\det(I-X)=1+r$ for some $r\in J$.

    (ii): Apply (i) to $M/N$ and use the correspondence of submodules.
\end{proof}
\begin{proof}[Proof of thm]
    Can change coord, so wlog assume $P=0$ and $T_{C,P}=\{x_2=\cdots=x_n=0\}$. Can also assume $C$ is affine. So there exists polys $f_2,...,f_n\in I(C)$ with $f_j=x_j+h_j$, where temr of $h_j$ all have deg $\ge 2$, so in $\mathcal O_P$ we have $x_j=h_j\in\mathfrak m_P^2$. So $\mathfrak m_P=x_1\mathcal O_P+\mathfrak m_P^2$. Apply Nakayama with $N=x_1\mathcal O_P\subseteq M=\mathfrak m_P=J\subseteq R=\mathcal O_P$. There exists $r\in\mathfrak m_P$ s.t. $(1+R)M\subseteq N$. Since $r\in\mathfrak m_P$, $1+r$ is a unit, so $M\subseteq N$, i.e., $\mathfrak m_P=x_1\mathcal O_P$.
\end{proof}
\begin{crly}
    Let $C$ is an affine plane curve (possibly singular) $Z(f)\subseteq\bA^2$. Let $P\in C$ be a smooth point. Then the function $C\to k$, $Q\mapsto x(Q)-x(P)$ is a local coordinate at $P$ if $\partial_yf(P)\neq0$.
\end{crly}
\begin{proof}
    Wlog by translation, assume $P=(0,0)$ with tangent space $\{aX+bY=0\}$. THe proof of previous thm shows that $Y\in X\mathcal O_p+\mathfrak m_P^2$ precisely when $\partial_yf(P)\neq0$ so in this case $X$ is a local coord at $P$.
\end{proof}
\begin{thm}[Generalized Eisenstein]
    Let $R$ be an integral domain, $\mathfrak p$ a prime ideal of $R$, $f(x)=a_nx^n+\cdots+a_1x+a_0$, $a_n\notin \mathfrak p$, $a_i\in\mathfrak p$ for $0\le i<n$ and $a_0\notin\mathfrak p^2$. Then if $f(x)=g(x)h(x)$ in $R[x]$, $g$ or $h$ is constant.
\end{thm}
\begin{proof}
    cf. GRM, reduce to $(R/\mathfrak p)[x]$.
\end{proof}
\begin{example}
    $x^d+y^d+z^d\in k[x,y,z]$. Have $y^d+z^d=\prod_{\zeta^d=-1}(y-\zeta z)$. Any $y-\zeta z$ generates a prime ideal. Apply Eisenstein, conclude irred.
\end{example}

Local coord at $P$ $\implies \mathcal O_P$ is a discrete valuation ring.
\begin{crly}
    Let $P$ be a smooth point of a possibly singular curve $C$. Then there exists a surjective hom $\nu_P:k(C)^\times\to \ZZ$ called the valuation at $P$ with the following properties [defn of discrete valuation ring]
    \begin{enumerate}[(i)]
        \item $\mathcal O_P=\{0\}\cup\{f\in k(C)^\ast:\nu_P(f)\ge 0\}$
        \item $\mathfrak m_P=\{0\}\cup\{f\in\mathcal O_P:\nu_P(f)>0$
        \item $\nu_P(x+y)\ge \min\{\nu_P(x),\nu_P(y)\}$ with equality if $\nu_P(x)\neq\nu_P(y)$
    \end{enumerate}

    If $f\in k(C)^\times$, then for any local parameter $\pi_P$ at $P$, we can find a unit $u\in\mathcal O_P$ s.t. $f=u\pi_P^{\nu_P(f)}$.
\end{crly}
[Often define $\nu_P(0)=\infty$]
\begin{proof}
    This is a local statement, so assume wlog $C$ is affine. Write $\mathfrak m_P=(\pi_P)$ by the previous theorem. Consider the ideal $I=\bigcap_{n\in\NN}\mathfrak m_P^n$. Clearly have $\mathfrak m_PI=I$. $I$ is f.g. as $\mathcal O_P$ is Noetherian. Apply Nakayama, find $r\in\mathfrak m_P$ s.t. $(1+r)I=0$, so $I=0$ since $1+r$ is a unit. For any $f\in\mathcal O_P\setminus\{0\}$, there exists $n$ s.t. $f\in\mathfrak m_P^n\setminus\mathfrak m_P^{n-1}$. Define $\nu_P(f)=n$. Given $f=g/h\in k(C)^\times$, choose $g,h\in\mathcal O_P$, and define $\nu_P(f)=\nu_P(g)-\nu_P(h)$. Can check well-definedness. 

    Use $\mathcal O_P\supseteq\mathfrak m_P\supseteq\mathfrak m_P^2\supseteq\cdots$ to write $g=u\pi_P^{\nu_P(g)}$ and $h=v\pi_P^{\nu_P}$, so $f=uv^{-1}\pi_{P}^{\nu_P(f)}$. If $x=u\pi_P^m$, $y=v\pi_P^n$, $u,v$ units in $\mathcal O_P$ and $n,m\in\ZZ$, then wlog $m\le n$ and $x+y=\pi_P^m(u+v\pi_P^{n-m})$. Note that $u+v\pi_P^{n-m}$ is regular at $P$, so inequality holds. If $n>m$, then $u+v\pi_P^{n-m}$ is a unit, so $\nu_P(x+y)=m=\min\{\nu_P(x),\nu_P(y)\}$.
\end{proof}
\begin{rem}
    If $P$ is a smooth point on a possibly singular curve and $f\in k(C)^\times$, then $f$ or $1/f$ is regular at $P$.
\end{rem}
\begin{thm}
    Let $X$ be a curve, and $\varphi:X\dashto \PP^m$ a rational map. Then $\varphi$ is a morphism on $X$. In particular, birational curves are isomorphic.
\end{thm}
\begin{proof}
    Wlog choose coords so $\varphi(C)\not\subseteq\{x_0=0\}$. Write $\varphi=(G_0:\cdots:G_m)=(1:\frac{G_1}{G_0}:\cdots:\frac{G_m}{G_0})$. If $G_i/G_0\in\mathcal O_P$, then $\varphi$ is regular at P. Suppose not, then define $r=\min\{\nu_P(G_i/G_0:i=1,...,m\}$. Multiply through by $\pi_P^{-t}$ for some local parameter $\pi_P$ at $P$, get $\varphi=(\pi_P^{-t}:\pi_P^{-t}\frac{G_1}{G_0}:\cdots:\pi_P^{-t}\frac{G_{m}}{G_0})$ which has at least one coord of valuation non-zero, all non-negative, so $\varphi$ is regular at $P$.

    If $\varphi:X\dashto Y$ is birational with inverse $\psi:Y\dashto X$, then $\psi\circ\phi:X\to X$ is birational which is identity on open dense $U\subseteq X$. $\varphi,\psi$ extend to morphisms, so it suffices to show that if $f:X\to X$ is a morphism with $f|_U=\id_U$ ($U$ open), then $f=\id_X$. The map $f\times \id:X\to X\times X$ maps $U$ to the diagonal which is closed as it's cut out by $x_iy_j-x_jy_i$, where $x_i,y_i$ are the respective coords on the factors of $X\times X$. $U$ is dense in $X$, so $(f\times \id)(X)\subseteq \overline{(f\times \id)(U)}$, so $(f\times \id )(X)\subseteq\Delta$. 
\end{proof}
\subsection{Maps Between Curves}
\begin{example}
    Let $C_d=Z(f_d)\subseteq\PP^2$ be a curve defined by a homogeneous poly $f_d$ of deg $d$. If $P\in\PP^2$, then the projection from $P$ gives a morphism $C_d\to \PP^1$. Note that smootheness is necessary, e.g. consider the nodal cubic $X=Z(y^2z-x^2(x+z))$. Has self-intersection at $(0:0:1)$. THen the projection $(x:y:z)\to (x:y)=(1:y/x)$ canno be ctsly extended to $(0:0:1)$.
\end{example}
\begin{prop}
    Let $\varphi:X\to Y$ is a non-const morphism of (possibly singular) curves. Then \begin{enumerate}[(i)]
        \item $\forall Q\in Y,\ \varphi^{-1}(Q)$ is finite
        \item $\varphi^\ast:k(Y)\hookrightarrow k(X)$ is an inclusion, which makes $k(X)$ a finite extension of $\varphi^\ast(k(Y))\cong k(Y)$.
    \end{enumerate}
\end{prop}
\begin{proof}
    (i): $\varphi^{-1}(Q)$ is closed and $\varphi$ is nonconst, so finite.

    (ii): $\varphi(X)$ is dense in $Y$, so $\varphi$ is dominant, so $\varphi^\ast$ is inj. If $\in k(Y)\setminus k$, then $x=\varphi^\ast(t)\in K(X)\setminus k$. Since $k$ is alg closed, $x$ must be transcendental, so $k(X)/k(Y)$ is a finite extension by transcendence degree.
\end{proof}
\[):\text{Owen is ill today}\]
\begin{defn}
    The degree of a map $\varphi:V\to W$ between curves is $\deg\varphi=[k(V):\varphi^\ast(k(W))]$.
\end{defn}
\begin{defn}
    Suppose $P\in V$ and $Q=\varphi(P)\in W$ are smooth points. The ramification degree of $\varphi$ at $P$ is $e_P=\nu_P(\varphi^\ast\pi_Q)$, where $\pi_Q\in\mathcal O_{W,Q}$ is a local parameter and $\nu_P:k(V)^\times\to \ZZ$ is the valuation at $P$. (so $\nu_P(t_p^n)=n$)
\end{defn}
Note that $e_P=\min\{\nu_P(x):x\in\varphi^\ast(\mathfrak m_Q)\mathcal O_{V,P}\}$, so $e_P$ doesn't depend on the choice of $\pi_Q$.

 If $\varphi$ is an isomorphism, then $\varphi^\ast(\mathfrak m_Q)\mathcal O_{V,P}=\mathfrak m_P$, so $e_P=1$, so $e_P=1$
\begin{defn}
   If $e_P=1$, then we say that $\varphi$ is unramified at $P$. Otherwise, say $\varphi$ is ramified at $P$.
\end{defn}
Picture: $\deg\varphi=\#\varphi^{-1}(Q)$ for generic point $Q\in W$.
\begin{example}
    $E=Z(y^2-(x^3-x))$, $\varphi:E\to\bA^1$, $(x,y)\mapsto x$. $\varphi^\ast(x)=x$. Suppose $P=(x_0,y_0)\in E$ with $\varphi(P)=Q=x_0\in\bA^1$. Then $\e_P=\nu_P(\varphi^\ast(x-x_0))=\nu_p(x-x_0)$. $x-x_0$ is a local parameter of $\mathcal O_{E,P}$ iff $\partial_yf\neq 0$ where $f=y^2-x^3+x$. So $\nu_P(x-x_0)=1$ iff $y_0\neq 0$. At $(\pm 1,0), (0,0)$, $y$ is a local parameter. In $\mathcal O_{E,P}$, write $y^2=x^3-x=(x-x_0)U(x)$ where $U(x)\in k[x]$ doesn't vanish at $x_0$. Have
    $\nu_P(y^2)=2\nu_P(y)=\nu_P(x^3-x)=\nu_P(x-x_0)+\nu_P(U)$, so $\nu_P(x-x_0)=2$ for $(\pm 1,0), (0,0)$.
\end{example}
\begin{thm}
    Let $\varphi:V\to W$ be a non-constant map between irreducible projective (possibly singular) curves. \begin{enumerate}[(i)]
        \item $\varphi$ is surjective and for all but finitely many $P\in V$, $e_P=1$.
        \item If $V$ and $W$ are smooth, then for all $Q\in W$, $\sum_{P\in \varphi^{-1}(Q)}e_P=\deg\varphi$.
    \end{enumerate}
\end{thm}
\begin{proof}[Proof of (i)]
    Since $V$ is projective, completeness theorem shows that $\varphi(V)\subseteq W$ is closed. $\varphi(V)$ is also irreducible and not a point, so $\varphi(V)=W$.

    Note $e_P=1$ iff $\varphi^\ast(\mathfrak m_Q)\mathcal O_{V,P}=\mathfrak m_P$. WLOG assume affine by intersecting with patches, so $V\subseteq \bA^n, W\subseteq \bA^m$. Have $\varphi=\pi_W\circ(\id\times\varphi)$. $\id\times \varphi$ is an iso onto its image, so may assume $V\subseteq \bA^{n+m}$ and $\varphi$ is the restriction of projection map $\bA^{n+m}\to\bA^m$. Suppose $P\in V$ and $Q=\varphi(P)=(q_1,...,q_m)$, then $\mathfrak m_Q=(y_1-q_1,....,y_m-q_m)$. So $e_P=1$ iff $(y_1-q_1,...,y_m-q_m)\mathcal O_{V,P}=\mathfrak m_P$. Apply primitive element theorem to $k(V)/k(W)$. Can write $k(V)\cong k(W)[\alpha]$. 
    Away from the finite set of poles of $\alpha$, $\mathfrak m_P=(y_1-q_1,...,y_m-q_m,\alpha-\alpha(P))$. So $e_P=1$ iff $\alpha-\alpha(P)\in \mathfrak m_Q\mathcal O_{V,P}$. $\alpha$ has min poly $p(\vec y,x)=x^d+a_{d-1}(\vec y)x^{d-1}+\cdots+a_0(\vec y)$, where $a_i(\vec y)\in k(W)$. If degree $1$, then we are done, so wlog assume $d\ge 2$. By clearing denominators, assume $a_j(\vec y)\in k[y_1,...,y_m]$ Factorize $p(\vec y,x)=a_d(\vec y)\prod_{i=1}^d(x-\beta_i)$ in $\overline{k(W)}$. Then $\operatorname{disc}(p)=a_d(\vec y)\prod_{i\neq j}(\beta_i-\beta_j)=\operatorname{Res}(p,\partial_xp)$ This vanishes identically on $W$ iff $p$ and $\partial_xp$ share a non-trivial factor. % is an element of $k(W)$.

    $p$ irred so $\Res(p,\partial_xp)\notin I(W)$, and so $\{Q\in W:\Res(p,\partial_xp)(Q)=0\}$ is closed proper so finite in $W$. Since preimages are finite, $U=\{P\in V:\Res(p,\partial_xp)(\varphi(P))=0\}$ is open dense in $V$, so $p$has no repeated root at any pt in $U$, so $\frac{p(\vec y,x)-p(\vec y,\alpha(P))}{\alpha-\alpha(P)}\in k(V)$ is a unit in $\mathcal O_{V,P}$ for all $P\in U$. Also have $p(\vec y,x)\in I(V)$ by defn, and $p(\vec y,\alpha(P))=p(y,\alpha(P))-p(\varphi(P),\alpha(P))\in\mathfrak m_{\varphi(P)}$, so $\alpha-\alpha(P)$ is a unit times an element of $\mathfrak m_{\varphi(P)}$.
    %Claim that away from the poles of $a_i$, $\{P\in V:\operatorname{disc}(p)(\varphi(P))\neq 0\}$ consists of unramified pts and includes all but finitely elements.
\end{proof}
\begin{rem}
    If remove the set $\{Q\in W:a_d(Q)=0\}$, then $Q$ has exactly $d$ preimages in $V$ under $\varphi$, all unramified, and so for the ramining points $Q\in W$, we have $\sum_{\varphi(P)=Q}e_P=\sum_{p_1,...,p_d}=1=d=\deg\varphi$.
\end{rem}
\begin{crly}
    Let $V$ be a curve, and $f\in k(V)^\times$ is a non-zero rational function. \begin{enumerate}[(i)]
        \item If $f$ is regular on $V$, then $f$ is constant.
        \item The set of points $P$ with $\nu_P(f)\neq 0$is finite, and $\sum_{P\in V}\nu_P(f)=0$.
    \end{enumerate}
\end{crly}
\begin{proof}
    Use $\bA^1\to\PP^1, t\mapsto (1:t)$. View $f$ as a morphism $\varphi:V\to\PP^1$. For (i), $f$ is regular at $P$ iff $\varphi(P)\neq( 0:1)$, so $f$ regular on $V$ $\implies$ $\varphi$ not surj, so const.

    For (ii) $\nu_P(f)\neq 0$ iff $f$ vanishes at $P$ or $1/f$ vanishes at $P$. $\varphi^{-1}(0)$, $\varphi^{-1}(\infty)$ are finite by hypothesis. If $f$ is const then $\nu_P(f)$ for all $P\in W$. If $f$ is nonconst, then so is $\varphi$. Let $t=x_1/x_0$ be a local coord at $(1:0)$, and $\varphi^\ast$ and $\varphi^\ast t= f$, so $e_P=\nu_P(\varphi^\ast t)=\nu_P(f)$. Similarly at $\infty$ $1/t=x_0/x_1$ is a local coord. $\varphi(P)=\infty\implies e_P=\nu_P(\varphi^\ast(1/t))=\nu_P(1/f)=-\nu_P(f)$, so $\sum_{p\in V}\nu_P(f)=\sum_{\varphi(P)=0}\nu_P(f)+\sum_{\varphi(P)=\infty}\nu_P(f)=\sum_{\varphi(P)}e_P-\sum_{\varphi(P)=\infty}e_P=0$ by previous thm.
\end{proof}
\subsection{Divisors on Curves}
\begin{defn}
    A divisor on a curve $V$ is a finite formal sum $\sum_{P\in V}n_PP$, $n_P\in\ZZ$. The set of divisors is the abelian group $\operatorname{Div}(V)=\bigoplus_{P\in V}\ZZ\langle P\rangle$. The degree $\sum n_PP$ is $\sum n_P$. 
\end{defn}
$D=\sum n_PP\mapsto \sum n_P$ is a hom, with kernel $\operatorname{Div}^0(V)$. The set $\{P\in V:n_P\neq 0\}$ is the support of the divisor $D$.
\begin{defn}
    Let $f\in k(V)^\times$ be a non-zero rational function. The divisor of $f$ is $\operatorname{div}(f)=\sum_{P\in V}\nu_P(f)P$. [By previous corollary, $\deg(\operatorname{div}(f))=0$.] Any $\operatorname{div}(f)$ is a principal divisor on $V$; the principal divisor form a subgroup of $\operatorname{Div}(V)$ (resp. $\operatorname{Div}^0(V)$). The quotient $\operatorname{Div}(V)/\{\text{principal divisors}\}$ is the divisor class group of $V$, $\cl(V)$ (or Picard group), (resp. degree $0$ divisor class group of $V$, $\cl^0(V)$). 
\end{defn}
\begin{defn}
    $D$ is linearly equivalent to $D'$ if there exists $f\in k(V)^\times$ s.t. $D-D'=\operatorname{div}(f)$. Write $D\sim D'$.
\end{defn}
\[{}_\neg\%\tag{Owen's Signature}\]
If $f,g\in k(V)$ on a curve $V$, then $\operatorname{div}(f)=\operatorname{div}(g)$, then $\nu_P(f)=\nu_P(g)$ for all $P\in V$, so $\nu_P(f/g)=0$ for all $P$, so $\operatorname{div}(f/g)=0$, so $f/g$ is constant since it doesn't give a surje morphism $V\to\PP^1$.
\begin{prop}
    Any degree $0$ divisor on $\PP^1$ is principal, so $\cl^0(\PP^1)=\{0\}$ and $\cl(\PP^1)\cong\ZZ$.
\end{prop}
\begin{proof}
    Suppose $D$ is a degree $0$ divisor on $\PP^1$. Write $D=\sum n_PP=n_\infty\infty+\sum_{p\in\bA^1}n_PP$. Note that $n_\infty=-\sum_{p\in\bA^1}n_P$. Construct the poly $f(t)=\prod_{p\in\bA^1}(t-P)^{n_P}$, $t=x_1/x_0$. Since $1/t$ is a local coord at $\infty=(0:1)$, $\nu_\infty(f)=-\sum_{p\in\bA^1}n_P=n_\infty$ as needed
\end{proof}
\begin{rem}
    If $V$ is a curve $\cl^0(V)=\{0\}$, then for $P\neq Q$ on $V$, $P-Q=\operatorname{div}(f)$ for some $f\in k(V)$. $f$ determines a morphism $\varphi:V\to\PP^1$ with $\varphi^{-1}(0)=P,e_P=1$, so $\deg\varphi=1$ so $k(V)=k(\PP^1)$, so $V\simeq\PP^1$.
\end{rem}
\begin{defn}
    $V\subseteq\PP^n$ a curve  and consider a hyperplane $H=Z(L)\subseteq\PP^n$ not containing $V$. The hyperplane section of $V$ by $H$ is the divisor $\operatorname{div}(H)=\sum n_PP$, where $n_P=\nu_P(L/x_i)$ for any $x_i(P)\neq 0$.
\end{defn}
\begin{rem}\
    \begin{enumerate}
        \item $x_i(P),x_j(P)\neq 0\implies x_i/x_j\in\mathcal O_P^\times\implies \nu_P(L/x_i)=\nu_P(L/x_j)$ (well-defined)
        \item All coeffs $n_P\ge 0$ for hyperplane section
        \item If $H=Z(L),H'=Z(L')$ are two hyperplanes not containing $V$, then $\operatorname{div}(H')-\operatorname{div}(H)=\operatorname{div}(L'/L)$, so all hyperplane sections have the same divisor class. Call this the hyperplane class
    \end{enumerate}
\end{rem}
\begin{defn}
    The degree of $V\subseteq\PP^n$ (curve) is $\deg(V):=\deg(\operatorname{div}(H))$ for any hyperplane $H$ not containing $V$. 
\end{defn}
If $f:V\overset{\simeq}{\to} W$ is an isomorphism of curves, then $\operatorname{Div}(V)\cong\operatorname{Div}(W)$. Principal divisors are identified so $\cl(V)\cong\cl(W)$. However, degree need not be preserved, e.g., the twisted cubic in $\PP^3$ has degree $3$, but it's isomorphic to $\PP^1$. (cf. Veronese embedding)
(linear) Change of coordinate on $\PP^n$ preserves degree.

If $G$ is homogeneous of degree $m$, $V\subseteq\PP^n$ curve, then can define $\operatorname{div}(G)=\operatorname{div}(Z(G))=\sum n_PP$, where $n_P=\nu_P(G/x_i^m)$, $x_i(P)\neq0$, so $\operatorname{div}(G)\sim m\operatorname{div}(H)$.
\begin{example}
    Let $V\subseteq\PP^2$ be a curve. Claim that there exists a line not tangent to $V$ at any point. Recall can identify the space of lines $\{ax+by+cz=0\}$ in $\PP^2$ with points $(a:b:c)$. Consider the map $P\mapsto \text{line tangent to $V$ at $P$}$ is a morphism $V\to\PP^2$, which has image dimension $\le 1$, not surj.
    
    Apply a linear change of coords to assume $\{x_0=0\}$ is such a line. Write $V=Z(f)$, where $f$ is homogeneous of degree $d$. We have $f(0,x_1,x_2)$ is a deg $d$ homogeneous poly in $2$ variables with no repeated linear factors, so there exists exactly $d$ pts in $V\cap H$, so $\deg(V)=d$.
\end{example}
\begin{defn}
    We say a divisor $D=\sum m_PP$ is effective if $n_P\ge 0$ for all $P$. 
\end{defn}
\begin{defn}
    Let $D=\sum n_PP$ be a divisor on a curve $V$. The space of rational functions with poles bounded by $D$ is $L(D)=\{f\in k(V):\nu_P(f)+n_P\ge 0\}=\{f\in k(V):f=0\text{ or }\operatorname{div}(f)+D\text{ is effective}\}$.
\end{defn}
The map $f\mapsto \operatorname{div}(f)+D$ identifies $L(D)$ with the set of effective divisors equivalent to $D$.

The inequality $\nu_P(f+g)\ge\min\{\nu_P(f),\nu_P(g)\}$ implies that $L(D)$ is a vector space over $k$.
\begin{itemize}
    \item If $P\notin\operatorname{supp}(D)$, this requires $f$ regular at $P$
    \item If $n_P>0$, $f$ has a pole of order $\le n_P$ at $P$
    \item $n_P<0$, $f$ has a zero of order $\ge -n_P$ at $P$
\end{itemize}
\begin{example}
    $V=\PP^1$. Write $(0:1)=\infty$. Let $D=m(\infty)$, $m>0$. Write $x=x_1/x_0$. See that $L(D)$ is spanned by $1,x,x^2,...,x^m$, so $L(D)$ picks out polys of deg $\le m$, and $\dim L(D)=m+1$.
\end{example}
\begin{defn}
    $\ell(D):=\dim L(D)$
\end{defn}
\begin{prop}
    Let $D$ be a divisor on a curve $V$. \begin{enumerate}[(i)]
        \item $\deg D<0\implies L(D)=\{0\}$
        \item $\deg(D)\ge 0\implies \ell(D)\le \deg(D)+1$
        \item $\ell(D)\le \ell(D-P)+1$ for all $P\in V$
    \end{enumerate}
\end{prop}
\begin{proof}
    (i) If $\deg (D)<0$, then no effective divisor can be equiv to $D$.
    (iii) implies (ii) by induction on $\deg D$.
    (iii) Have $\operatorname{ev}_P:L(D)\to k,\ f\mapsto (\pi_P^{n_P}f)(P)$ for any local parameter $\pi_P$ at $P$. This is a well-defined homomorphism, with kernel $\{f:\nu_P(f)+n_P\ge 1\}=\{f:\nu_P(f)+n_P-1\ge 0\}=\ell(D-P)$. The image has dimension $1$, so $\ell(D-P)\ge \ell(D)-1$.
\end{proof}
\begin{prop}
    Suppose $D,E\in\operatorname{Div}(V)$, $D\sim E$. Then $L(D)\cong L(E)$ and $\ell(D)=\ell(E)$.
\end{prop}
\begin{proof}
    $D-E=\operatorname{div}(g)$ for some $g\in k(V)$. Consider $L(D)\to L(E)$, $f\mapsto fg$. $f\in L(D)$ iff $f\in L(E+\operatorname{div}(g))$ iff $\operatorname{div}(f)+\operatorname{div}(g)+E\ge 0$ iff $\operatorname{div}(fg)+E\ge0$ iff $fg\in L(E)$.
\end{proof}
\[(>::=\tag{Owen's Signature}\]
\begin{thm}[Weak Bezout for curves]
    Any two distinct plane curves intersect. If the degreeso f curves are $m,n$, then they intersect in $\le mn$ pts.
\end{thm}
\begin{proof}
    Let $F,G$ be homogeneous in 3 variables, degree $m,n$ resp., call $E=Z(F), D=Z(G)\subseteq\PP^2$. Can find an effective divisor $\operatorname{div}(G)$ which has the form $\sum_{P\in C\cap D}n_PP$. WTS $1\le \deg(\operatorname{div}(G))\le mn$. We know $\operatorname{div}(G)\sim\operatorname{div}(L^n)$ for any lienar form $L$ with $C\not\subseteq Z(L)$. Suffices to show that $1\le \operatorname{div}(L)\le m$. From ES1, $\exists P\in C\cap L$ ($L$ intersects $V$ transversely) s.t. $\operatorname{div}(L)=\sum_{P\in C\cap Z(L)}P$. Change coords so $L=x_0$, algebraic closure $\implies 1\le \operatorname{div}(L)\le m$.
\end{proof}
\begin{rem}
    For general choice of $F,G$, $|C\cap D|=mn$. With correct notion of multiplicity $I(C\cap D,P)$, have $\sum_{P\in C}I(C\cap D,P)=mn$. $I(C\cap D,P)=\nu_P(G/x_P^n)$ in $\mathcal O_{C,P}=\dim_k\mathcal O_{\bA^2,P}/(f,g)$, where $f,g$ are dehomogenization of $F,G$ in coords with $P\in\bA^2$.
\end{rem}
\begin{defn}
    Let $X\subseteq\PP^n$ be a projective variety of dim $m$. The degree of $X\hookrightarrow \PP^n$ is $\#(X\cap H_1\cap \cdots\cap H_m)$ for generic hyperplanes $H_1,...,H_m$
\end{defn}
\begin{thm}[Bezout for hypersurfaces]
    Let $X\subseteq\PP^n$ be a projective variety, $F\in k[x_1,...,x_n]$ homogeneous poly with $Z(F)$ not containing any componenet of $X$. Then $\deg(X\cap Z(F))=\deg(X)\deg(F)$.
\end{thm}
Proof omitted.
\begin{crly}
    There is no nonconst morphism $\PP^2\to\PP^1$
\end{crly}
Proof in ES3.
\begin{thm}
    If $f:\PP^n\to\PP^n$ is an iso, then $f(x)=Ax$ for some $A\in GL_{n+1}(k)$.
\end{thm}
\begin{proof}
    $H$ hyperplane in $\PP^n$, $L$ line, $L\not\subseteq H$. Then $\operatorname{div}(H)$ on $L$ is a pt with coeff $1$, so has degree $1$, so $\operatorname{div}(f(H))$ on $f(L)$ has deg $1$. $f(H)$ and $f(L)$ have degree 1, so $f(H)$ is a hyperplane. Apply to coord hyperplanes $\{x_i=0\}=H$ get $f(H)=\{a_{0i}x_0+\cdots+a_{ni}x_n=0\}$. Let $A=(a_{ji})$.
\end{proof}
\subsection{Differentials}
$K/L$ field extension.
    A differential is a $k$-linear combination of formal symbols $xdy$ with $x,y\in K$ s.t. 
    \begin{enumerate}[(1)]
        \item $d(\cdot)$ is linear.
        \item Leibniz rule $d(xy)$
        \item $da=0$ for $a\in k$.
    \end{enumerate}
\begin{defn}
    The space of differentials $\Omega_{K/k}=\Omega_K$ is the quotient $M/N$ where $M=\langle\delta x:x\in K\rangle$ and $N$ is the subspace generated by
    \begin{enumerate}[(1)]
        \item $\delta(x+y)=\delta x-\delta y$;
        \item $\delta(xy)=x\delta y-y\delta x$
        \item $\delta a$, $a\in k$
    \end{enumerate}
    For $x\in K$, define $dx$ to be the coset $\delta x+N$. The map $d:K\to\Omega_{K/k}$ is the exterior derivative.
\end{defn}
\begin{lem}
    Suppose $K/k$ is f.g. with a transcendence basis $\{x_1,....,x_n\}$. Then if $f\in k(x_1,...,x_n)$ is a rational function in $x_1,...,x_n$ and $y=f(x_1,...,x_n)$.
    \[dy=\sum_{i=1}^n\frac{\partial f}{\partial x_i}(x_1,....,x_n)dx_i\]
    $\{dx_1,...,dx_n\}$ is a basis for $\Omega_K$.
\end{lem}
\begin{defn}
    Let $V$ be a curve, $K=k(V)$. We write $\Omega_V=\Omega_{K/k}$, the space of rational differentials on $V$. A differential $\omega\in\Omega_V$ is regular at $P\in V$ if we can express $\omega=\sum_i f_idg_i$, $f_i,g_i$ are regular at $P$.
\end{defn}
\begin{defn}
    $\Omega_{V,P}=\{\omega\in\Omega_V:\omega\text{ regular at }P\}$
\end{defn}
\begin{prop}
    $\Omega_{V,P}=\mathcal O_{V,P}d\pi_P$ for any local parameter $\pi_P$.
\end{prop}
\begin{proof}
    $\supseteq:$ clear from defn. Partials of $g/h$ regular at $P$ iff $h(P)\neq0$. $dx_i$ generate $\Omega_{V,P}$ over $\mathcal O_{V,P}$, so $\Omega_{V,P}$ is finitely generated over $\mathcal O_{V,P}$.

    If $f\in\mathcal O_{V,P}$, $d(f-f(P))=d(\pi_P g)=gd\pi_P+\pi_Pdg\in\mathcal O_{V,P}{d\pi_P}+\pi_P\Omega(V,P)$, for some $g\in\mathcal O_{V,P}$. By Nakayama ($R=\mathcal O_{V,P}, M=\Omega_{V,P}, N=\mathcal O_{V,P}d\pi_P, J=\mathfrak m_P$), so $M\subseteq N$.
\end{proof}
If $\pi_P$ is a local parameter at $P$, then $\pi_P$ is transcendental over $k$, so $d\pi_P$ generates $\Omega_V^\times$ so any differential $\omega=hd\pi_P$. $h$ depends on the choice of $\pi_P$, but $\nu_P(h)$ is indep of $\pi_P$.
\begin{defn}
    In the above setting, define $\nu_P(\omega)=\nu_P(h)$ for any choice of local parameter $\pi_P$. If $\nu_P(\omega)=0$ then $\omega$ has a zero at $P$. If $\nu_P(\omega)<0$, then $\omega$ has a pole at $P$. If $\omega\in\Omega_V^\times$ then $\divi(\omega)=\sum_{P\in V}\nu_P(\omega)P$
\end{defn}
\begin{lem}
    Let $\omega$ be a non-zero rational differential on a curve $V$. Then $\nu_P(\omega)=0$ for all but finitely many $P\in V$. $\nu_P(\omega)\ge=0$ iff $\omega$ is regular at $P$.
\end{lem}
\begin{proof}
    Note that if $\omega,\omega'\in\Omega_V^\times$, then write $\omega=hd\pi_P$, $\omega'=h'd\pi_P$, have $\nu_P(\omega+\omega')=\nu_P(h+h')\ge\min\{\nu_P(h),\nu_P(h')\}=\min\{\nu_P(\omega),\nu_P(\omega')\}$.

    First, if $g\in k(V)$ is nonconst and $\omega=fdg$, then for any $P\in V$, have $\nu_P(\omega)=\nu_P(f)+\nu_P(dg)$, so suffices to show $\nu_P(dg)=0$ for all but finitely many $P$ and any nonconst $g$. By finiteness for curves, $g$ (when considered as a morphism $V\to\PP^1$) has finitely many poles and finitely many ramified pts. If $g(P)\neq\infty$ and $t$ is a local coord at $0$ on $\PP^1$, then $t-g(P)$ is a local coord at $g(P)$, and $f,g$ is also not ramified at $P$, and $g^\ast(t-g(P))=g-g(P)$ is a local parameter at $P$, so we have
    \[\nu_P(dg)=\nu_P(d(g-g(P)))=\nu_P(1)=0\]

    $\Rightarrow:$ clear.\\
    $\Leftarrow:$ Suppose $\omega=\sum f_idg_i$, $f_i,g_i$ ae regular at $P$. By valuation inequality, suffices to show that $\nu_P(f_idg_i)\ge 0$ for all $i$, so suffices to show $\nu_P(dg)\ge 0$ for all $g\in \mathcal O_{V,P}^\times$. Have $dg=d(g-g(P))=d(\pi_P^nh)$, where $n=\nu_P(g-g(P))$ and $h$ is a unit in the local ring. If $n=1$, then $g-g(P)$ is a local parameter, so $\nu_P(dg)=\nu_P(d(g-g(P)))=0$. If $n>1$, then apply Leibniz rule
    \[d(\pi_P^nh)=\pi_P^{n-1}d(\pi_Ph)+\pi_Phd(\pi_P^{n-1})=\pi_P^{n-1}d(\pi_Ph)+(n-1)\pi_Ph\pi_P^{n-2}d\pi_P\]
    Each term has valuation $n-1$, so $\nu_P(d(g-g(P)))\ge n-1>0$.
\end{proof}
So $\divi(\omega)$ is a divisor for any $\omega\in\Omega_V^\times$.
\begin{defn}
    $K_V=\divi(\omega)$ is called a canonical divisor for $V$.
\end{defn}
\begin{lem}
    $\divi(\omega)\sim\divi(\omega')$ for $\omega,\omega'\in\Omega_V^\times$.
\end{lem}
\begin{proof}
    Since $\Omega_V$ is a 1-dim, so $\omega=f\omega'$ for some $f\in k(V)^\times$. By defn, $\divi(\omega)-\divi(\omega')=\divi(f)$.
\end{proof}
\begin{defn}
    We call the class of $K_V$ in $\cl(V)$ the canonical class.
\end{defn}
\begin{rem}
    Everything in this subsection depends only on the function fields, so isomorphism-invariant.
\end{rem}
\begin{example}
    $V=\PP^1$. Let $\bA^1\hookrightarrow\PP^1$, $x_1\mapsto (1:x_1)$. Define $t=x_1/x_0$, then $\omega=dt$ is a non-zero rational differentia. If $a\in \bA^1$, then $t-a$ is a local parameter at $a$, and $dt=d(t-a)$, $\nu_a(dt)=0$. At $\infty$, $1/t=x_0/x_1$ is a local parameter, and we have $d(1/t)=-dt/t^2$, so $\omega=-t^2d(1/t)$, so $\nu_\infty(\omega)=\nu_\infty(t^2)=-2$, so $\divi(\omega)=-2\infty$. Since $\deg(\divi(\omega))<0$, this is neither principal not a hyperplane section.
\end{example}
\begin{defn}
    $V$ a curve. The genus $g(V)=\ell(K_V)$, where $K_V$ is any element of the canonical class.
\end{defn}
\textbf{Note $0\in L(D)$.}
\begin{example}
    $g(\PP^1)=\ell(-2\infty)=0$, since degree $<0$.
\end{example}
This agrees with the defn in Riemann surfaces if $k=\CC$.
\subsection{Differentials on Plane Curves}
\subsubsection{Plane Cubics}
Let $F(x_0,x_1,x_2)=x_0x_2^2-\prod_{i=1}^3(x_1-\lambda_ix_0)$, $\lambda_1,\lambda_2,\lambda_3\in k$ are distinct. Can check $V=Z(F)$ is irreducible and smooth.

Compute its geneus. Dehomogenize w.r.t. $x_0$, get $y^2=(x-\lambda_1)(x-\lambda_2)(x-\lambda_3)=g(x)$, where $y=x_2/x_0$, $x=x_1/x_0$, so $2ydy=g'(x)dx$ in $\Omega_V$. Choose $\omega=dx/y=2dy/g'(x)$. If $y(P)\neq 0$, then $x-x(P)$ is a loc. coord for $P\in V$ with $x_0\neq 0$. So $\nu_P(\omega)=\nu_P(dx/y)=0$. If $y(P)=0$, thne $y$ is a loc coord at $P$ and $\lambda_i$ distinct $\implies$ $g'(x(P))\neq 0$, so $\nu_P(\omega)=0$. If $x_0=0$, have a single point $\infty=(0:0:1)$. Dehomogenize w.r.t. $x_2$ to obtain $z-\prod_{i=1}^3(t-\lambda_iz)$, $z=x_0/x_2$ and $t=x_1/x_2$. $t$ is a local parameter at $\infty$, i.e., $\nu_\infty(t)=1$, $\nu_\infty(z)\ge 3$, so $\nu_\infty(t-\lambda_iz)=\nu_\infty(t)=1$, so $\nu_\infty(z)=3$. Note that $\nu_\infty(y)=-3$, $\nu_\infty(x)=-2$.
\begin{lem}
    If $h\in k(V)$ on a curve $V$, and $\nu_P(h)\ge 2$ for $P\in V$, then $\nu_P(dh)=\nu_P(h)-1$.
\end{lem}
\begin{proof}
    If $\nu_P(h)=1$, then true by defn. If $\nu_P(h)\ge 2$, then write $h=u\pi_P^n$, $n=\nu_P(h)$. Have $dh=u\pi_Pd(\pi_P^{n-1})+\pi_P^{n-1}d(u\pi_P)=u\pi_P^{n-1}(n-1)d\pi_P+\pi_P^{n-1}d(u\pi_P)=\pi_P(n-1)(u(n-1)d\pi_P+ud\pi_P+\pi_Pdu)=\pi_P^{n-1}[und\pi_P+\pi_Pdu]$. $u$ is regular at $P$ so $\nu_P(du)\ge 0$, so $\nu_P(\pi_Pdu)\ge 1$, so $\nu_P(dh)=n-1$ ($\ast\ast\ast\ast$)
\end{proof}
$\nu_\infty(1/x)=2$ so $\nu_\infty(d(1/x))=1$, so $\nu_\infty(-dx/x^2)=\nu_\infty(1/x^2)+\nu_\infty(dx)=1$. Since $\nu_\infty(1/x^2)=4$, $\nu_\infty(dx)=-3$, so $\nu_\infty(\omega)=\nu_\infty(dx/y)=0$. So the canonical divisor is the zero divisor, so $L(0)=\{\text{rational functions on }V\text{ with no poles}\}=k$, so $\ell(K_V)=1=g(V)$. For a general plane curve, we have
\begin{thm}
    Let $V=Z(F)\subseteq\PP^2$ be a smooth plane curve of degree $d\ge 3$. Then $K_V=(d-3)H$, where $H$ is the divisor of a hyperplane section on $V$.
\end{thm}
\begin{rem}
    Computation: given $x_0x_2^2-\prod_{i=1}^3(x_1-\lambda_ix_0)$. The projection to $(x_0:x_1)\in\PP^1$ has deg $2$ [$\infty\mapsto (0:1)$ with $\nu_\infty(x)=-2$]; the proj to $(x_0:x_2)$ has deg $3$ [$\infty\mapsto (0:1)$ and $\nu_\infty(y)=-3$].
\end{rem}
\begin{proof}
    Change coords so $(0:1:0)\notin V$. Dehomogenize $x=x_1/x_0$ and $y=x_2/x_0$ to obtain $0=f(x,y)=F(1,x,y)$, so $\partial_x fdx+\partial_yfdy=0$, so consider $\omega=dx/\partial_yf=-dy/\partial_xf$. Let $H=\{x_0=0\}$, so $\divi(\omega)$ is supported on $H$. Now dehomogenizae w.r.t. $x_2$ to get $g(z,w)=F(z,w,1)$, $z=x_0/x_2=1/y$ and $w=x_1/x_2=x/y$ and consider $\eta=dz/\partial_wg=-dw/\partial_zg$. $\divi(\eta)$ is supported on $\{x_2=0\}$ not at any $P\in H\cap V$. Note that $f(x,y)=F(1,x,y)=y^dF(1/y,x/y,1)=y^dg(1/y,x/y)$. Compute
    \begin{align*}
        \partial_xf=y^d\partial_wg(1/y,x/y)1/y=\frac{1}{z^{d-1}}\partial_wg(z,w)
    \end{align*} Since $y=1/z$, have $dy=-dz/z^2$, so 
    \[\omega=\frac{dy}{\partial_xf}=\frac{-z^{-2}dz}{(z)^{1-d}\partial_wg(z,w)}=z^{d-3}\eta\] 
    Since $\nu_P(\eta)=0$ for all $P\in H$, we have $\nu_P(\omega)=(d-3)\nu_P(x_0/x_2)$ for all $P\in H$, so $\omega=(d-3)H$ since $H=\divi(x_0)$.
\end{proof}
So $\deg(K_V)=d(d-3)$ for a smooth plane curve.
\begin{prop}
    Suppose $f(x,y)=0$ is an affine equation for a curve $V\subseteq\PP^2$. Assume $\deg V\ge3$. Then $\{x^ry^s:0\le r+s\le d-3,\ r,s\ge 0\}$ is a basis for $L(K_V)$
\end{prop}
\begin{proof}
    By thm, all poles of any elt of $L(K_V)$ are at $\infty$ (if $x=x_1/x_0$, $y=x_2/x_0$, this means that they satisfy $x_0(P)=0$). $x,y$ generate $k(V)$ as a field, so any elt of $L(K_V)$ is a polynomial in $x,y$, so monomials $x^ry^s$ generate $L(K_V)$, since $x^ry^s=\frac{x_1^rx_2^s}{x_0^{r+s}}\in L(K_V)$ iff $0\le r+s\le d-3$. It suffices show independence. Note that any non-trivial dependence relation would give a degree $<d$ element of the (affine) ideal. Contradiction.
\end{proof}
\begin{crly}[Genus-degree formula for plane curves]
    If $V$ is a smooth plane curve in $\PP^2$ of degree $\ge3$. Then $g(V)=\frac{(d-1)(d-2)}{2}$
\end{crly}
\begin{crly}
    There exists infinitely many non-isomorphic curves.
\end{crly}
\section{Riemann-Roch}
\begin{thm}[Riemann-Roch]
    Let $V$ be a curve of genus $g$ with canonical divisor $K_V$. Then for any divisor $D$, $\ell(D)-\ell(K_V-D)=1-g+\deg(D)$.
\end{thm}
\begin{crly}[Genus-degree formula for curves in $\PP^2$]\end{crly}
\begin{proof}
    Take $D-K_V$, so R-R implies $\ell(K_V)-\ell(0)=1-g+\deg(K_V)$, so $g-1=1-g+d(d-3)$. 
\end{proof}
\[\overset{\overset{\leftharpoondown\rightharpoondown}{\overset{\smallfrown}{O}\vert\overset{\smallfrown}{O}}}{\smile}\tag{Owen's signature}\]
\begin{crly}
    If $V$ is a curve, $\deg(K_V)=2g-2$.
\end{crly}
\begin{proof}
    Take $D=K_V$. Apply Riemann-Roch, so $\ell(D)=g$ and $\ell(K_V-D)-\ell(0)=1$.
\end{proof}
\begin{crly}
    Let $D$ be a divisor of $\deg(D)>2g-2$, then $\ell(D)=1-g+\deg(D)$. In particular, if $g=1$, then $\deg(D)>0\implies \ell(D)=\deg(D)$
\end{crly}
Consider $\varphi:V\to W$ a non-constant morphism of curves. $\varphi^\ast:k(W)\to k(V)$ sends non-constant $t\in k(W)$ to non-constant $\varphi^\ast t\in k(V)$, so $\Omega_W$ is generated by $dt$ and $\Omega_V$ by $d\varphi^\ast t$. Given $\omega=fdt\in\Omega_W$, define $\varphi^\ast\omega=\varphi^\ast(f)d\varphi^\ast t$.
\begin{lem}
    $\varphi:V\to W$ a non-const morphism of curves. Let $P\in V$, $\varphi(P)=Q$, $e_P$ ramification index of $\varphi$ at $P$, $\pi_P,\pi_Q$ local parameters at $P,Q$ resp. Then $\nu_P(\varphi^\ast\omega)=e_P\nu_Q(\omega)+e_P-1$. In particular, $\nu_P(\varphi^\ast d\pi_Q)=e_P-1$.
\end{lem}
\begin{proof}
    $\nu_P(\varphi^\ast(d\pi_Q))=\nu_P(d(\varphi^\ast\pi_Q))=e_P-1$. For general $\omega$, write $\omega=u\pi_Q^{\nu_Q(\omega)}d\pi_Q$, $u\in\mathcal O_{W,Q}^\times$. Then $\varphi^\ast\omega=\varphi^\ast(u)\varphi^\ast(\pi_Q)^{\nu_Q(\omega)}d(\varphi^\ast\pi_Q)$, so $\nu_P(\varphi^\ast\omega)=e_P\nu_Q(\omega)+e_P-1$.
\end{proof}
\begin{thm}[Riemann-Hurwitz]
    Let $\varphi:V\to W$ be a non-constant morphism of curves and let $n=\deg\varphi$. Then $2g(V)-2=n(2g(W)-2)+\sum_{P\in V}(e_P-1)$.
\end{thm}
\begin{proof}
    Let $0\neq \omega\in\Omega_W$, so $\varphi^\ast\omega\in\Omega_V^\times$, so $\divi(\varphi^\ast\omega)$ is $K_V$. By Riemann-Roch, $\deg(K_V)=2g(V)-2$, so \begin{align*}2g(V)-2&=\sum_{P\in V}\nu_P(\varphi^\ast\omega)=\sum_{Q\in W}\sum_{\varphi(P)=Q}\\
    &=\sum_{Q\in W}\sum_{\varphi(P)=Q}(e_P\nu_Q(\omega)+e_P-1)\\
    &=\sum_{Q\in W}\deg(\varphi)\nu_Q(\omega)+\sum_{P\in V}(e_P-1)\\
    &=\deg(\varphi)\deg(\divi(\omega))+\sum_{P\in V}(e_P-1)\end{align*} The first term is $n(2g(W)-2)$.
\end{proof}
\begin{crly}
    If $V, W$ are curves and $g(V)<g(W)$, then any morphism $\varphi:V\to W$ is constant.
\end{crly}
\begin{crly}
    Let $X=V_1\times V_2$ be product of two curves of genus $\ge 1$, then $X$ is a smooth projective surface with no subvariety isomorphic to $\PP^1$.
\end{crly}
\begin{proof}
    Riemann-Hurwitz applied to the projection maps.
\end{proof}
\subsection{Equations (not embedding???) of Curves}
\begin{defn}
    Let $V$ be a curve and $D$ a divisor on $V$ with $\ell(D)=n+1\ge 2$. Let $B=\{f_0,...,f_n\}$ be a basis for $L(D)$. The morphism associated to $D$ w.r.t. basis $B$ is $\varphi_D=(f_0:\ldots:f_n):V\to\PP^n$ (nonconst morphism). We say $\varphi_D$ is an embedding if it is an isomorphism onto $\varphi_D(V)$ in which case we say $D$ is very ample.
\end{defn}
A different choice of basis corresponds to a linear change of coords on $\PP^n$, so omit $B$ from notation.\
Let $V\subseteq\PP^n$ be a curve, and $D=\divi(x_0)$ a hyperplane section. If $P\neq Q\in V$, then $\ell(D-P-Q)=\ell(D)-2$. The same is true if $P=Q$. Call this $(\ast)$. $D$ has $(\ast)$ if $\forall P,Q\in V$, $\ell(D-P-Q)=\ell(D)-2$.
\begin{thm}
    $\varphi_D$ is an embedding iff $D$ satisfies $(\ast)$.
\end{thm}
Proof omitted.
\begin{crly}
    If $\deg (D)\ge 2g+1$, then $\varphi_D$ is an embedding.
\end{crly}
\begin{proof}
    For $D, D-P-Q$, we have $\ell(D)=1-g-\deg(D)$, $\ell(D-P-Q)=1-g-\deg(D-P-Q)=1-g-(\deg(D)-2)$.
\end{proof}
\begin{crly}
    For fixed genus, if $g\ge 2$, then $\exists m=m(g)$ s.t. $mK_V$ is very ample.
\end{crly}
\subsection{Elliptic Curves}
\begin{defn}
    An elliptic curve is a curve of genus $1$ together with a base point $P_0\in E$ (written $\mathcal O_E$).
\end{defn}
Suppose $P,Q\in E$ elliptic curve $(E,P_0)$. The divisor $P+Q-P_0$ has degree $1$, so $\ell(P+Q-P_0)=1$, so $\exists$ an effective deg 1 divisor equivalent to $P+Q-P_0$, i.e., $R\in E$ s.t. $P+Q-P_0\sim R$. Distinct pts on $E$ are inequivalent (since $E\not\cong\PP^1$. For any curve of genus $>0$, if $P\sim Q$, then there exists $f$ with a simple pole, which would imply that $f$ is an isomorphism to $\PP^1$), so $R$ is unique. Define $P\oplus_E Q=R$, i.e., $P+Q=R$. 
\begin{thm}
    $\oplus_E$ makes $E$ into an abelian group with identity $\mathcal O_E=P_0$. The map $P\mapsto [P-P_0]\in\cl^0(E)$ is an isomorphism of groups.
\end{thm}
\begin{proof}
    Define $\beta(P)=[P-P_0]$. If $P,Q\in E$, then $\beta(P+Q)=\beta(R)=[R-P_0]=[P+Q-P_0-P_0]=[P-P_0]+[Q-Q_0]=\beta(P)+\beta(Q)$. $\beta$ is injective since $P-P_0\sim Q-P_0\implies P\sim Q\implies P=Q$. $\beta$ is surjective [let $D$ be a divisor of deg $0$, $D+P_0$ has degree $1$, so $\ell(D+P_0)=1$, so there exists a pt $P\in E$ s.t. $D+P_0\sim P$, so $D=\beta(P-P_0)$].
\end{proof}
\begin{rem}
    In genus $>1$, the injectivity argument still applies, so $V$ injects into a group. One can show that this group is a projective variety of dimension $g$, called the Jacobian of $V$.
\end{rem}
\[\underset{\cdot.}{\frown}\tag{Owen's signature}\]
\begin{thm}
    Let $(E,P_0)$ be an elliptic curve, then $3P_0$ provides an embedding of $E$ into $\PP^2$ as a plane cubic.
\end{thm}
\begin{proof}
    If $\deg D=m>0$, then $\ell(D)=\deg(D)$, so $mP_0$ is an embedding if $m\ge 3$. $\ell(mP_0)=m$ for $m>1$, so $L(3P_0)$ has a basis $1,x,y$ where $1,x$ is a basis for $L(2P_0)$, so $x$ is a degree $2$ morphism to $\PP^1$; $y$ is a degree 3 morphism to $\PP^1$ by considering preimages of $\infty$. So $(1:x:y):E\to\PP^2$ is an embedding.

    \begin{enumerate}
        \item $L(4P_0)$ has basis $1,x,y,x^2$
        \item $L(5P_0)$ has basis $1,x,y,x^2,xy$
        \item $L(6P_0)$ contains these and $x^3$ and $y^2$, but $\ell(6P_0)=6$, so there exists a non-trivial linear dependence relation necessarily involving both $y^2$ and $x^3$.
    \end{enumerate}
    Homogenizing, this is a cubic, so $E\subseteq Z(F)$ for a cubic $F$. The components of $Z(F)$ (if smooth) have genus $0$. $E$ is an isomrophism onto its image, so onto a smooth component, which cannot have genus $0$, so $Z(F)$ is irreducible and $E$ maps onto $Z(F)$.
\end{proof}

Note $P_0$ is the unique pt of $E$ sent to line at $\infty$. We may assume $P_0=(0:1:0)$ and that the cubic has no $yz^2$ term. ($P_0$ unique, $z=0\implies F(x,y,0)=x^3$), so $F:ay^2z+byz^2=G(x,z)$, so can make $b=0$ by affine change of coord and assume $F:y^2z=\prod_{i=1}^3(x-\lambda_iz)$.
\begin{thm}
     Let $E=Z(F)$, $F:y^2z=\prod_{i=1}^3(x-\lambda_iz)$ an elliptic curve with $P_0=(0:1:0)$. Then $P+Q+R=\mathcal O_E$ iff $P,Q,R$ are collinear.
\end{thm}
\begin{proof}
    Consider the map $\beta$. See that $P+Q+R=\mathcal O_E$ iff $P+Q+R\sim 3P_0$ iff $\exists$ rational function $f$ with $\divi(f)=P+Q+R-3P_0$. Note $f\in L(3P_0)$. So $f$ is a linear combination of $1,x,y$, i.e., $L(x,y,z)/z$ for a linear $L$. The zero set of $f$ is precisely $P,Q,R$, so $P,Q,R$ exists iff such an $f$ exists.
\end{proof}
\subsection{More Consequences of Riemann-Roch}
\begin{defn}
    A curve $V$ of genus $g\ge 2$ is hyperelliptic if $\exists\pi:V\to\PP^1$ nonconst of degree $2$.
\end{defn}
If $V$ is hyperelliptic, consider $D=\pi^\ast(\infty)$ (poles of $\pi$), then $L(D)$ has dim $\ge 2$ since $1,\pi\in L(D)$. On the other hand, for $Q\in V$, $\ell(Q)=1$ since $V$ doesn't have deg $1$ map to $\PP^1$. So $\ell(D)\le \ell(D-P)+1\le 2$, so $\ell(D)=2$.
\begin{prop}
    Let $g(V)>1$ and suppose there exists an effective divisor $D$ of degree $2$ on $V$ with $\ell(D)=2$. Then $\varphi_D:V\to\PP^1$ has degree $2$ (and $\varphi_D^\ast(\infty)=D$), so $V$ is hyperelliptic. All genus $2$ curves are hyperelliptic, and there exists hyperelliptic curve of every genus.
\end{prop}
\begin{proof}
    ES4
\end{proof}
\begin{prop}
    $g\ge 3$, $\varphi_{K_V}$ is an embedding iff $V$ is not hyperelliptic.
\end{prop}
\begin{proof}
    Suppose $\varphi_{K_V}$ is not an embedding. Then $\exists P,Q\in V$ s.t. $\ell(K_V-P-Q)\ge g-1$. $\ell(P+Q)=\ell(K_V-P-Q)+1-g+2\ge 2$ by R-R. Since $\ell(P+Q)\le \ell(P)+1=2$. Then the previous proposition implies that $V$ is hyperelliptic.

    Conversely, suppose $V$ is hyperelliptic. Then have $\pi:V\to\PP^1$ of degree $2$ with $\pi^\ast(\infty)$ effective divisor of degree $2$ and $\ell(D)=2$, so $\ell(K_V-D)\ge g-1$ working conversely.
\end{proof}

\[\overset{\rotatebox[origin=c]{60}{$\sim$}}{\rotatebox[origin=c]{90}{\aquarius}}\overset{\overset{\overset{\backslash\ /}{\aquarius}}{O\vert O}}{\smile}\overset{\rotatebox[origin=c]{120}{$\sim$}}{\rotatebox[origin=c]{90}{\aquarius}}\tag{Owen's signature final version}\]

\section{Blow-ups and Completeness of Projective Variety}
\begin{defn}
    A variety $V$ is complete if for all varieties $Y$, $\pi_2:X\times Y\to Y$ is closed.
\end{defn}
\begin{thm}
    Every projective variety is complete. (proper over the base field)
\end{thm}

Blowup of a point on groj space: Let $P=(0:\cdots:1)\in\PP^n$ and $H=Z(x_n)$. Projection $\pi_P$ from $P$. $\pi_P:\PP^n\dashto\PP^{n-1}$ regular away from $P$.
\begin{defn}
    The blowup of $\PP^n$ at $P$ is $Bl_P(\PP^n)=\overline{\Gamma_{\pi_P}}\subseteq \PP^n\times\PP^{n-1}$.
\end{defn}
Note that $Bl_P(\PP^n)=Z(\{x_iy_j-y_ix_j:0\le i,j\le n-1\})$. The first projection $\pi_1$ is a birational map $Bl_P(\PP^n)\to\PP^n$ with $\pi^{-1}(Q)=Q$ for all $Q\neq P$, and $\pi^{-1}(P)=\PP^{n-1}$. [$Bl_p(\PP^n)=\{Q,[L]:Q\in L\}\subseteq \PP^n\times \PP^{n-1}$. Parametrizes the lines through $P$.] The second projection $q:Bl_P(\PP^n)\to\PP^{n-1}$ is the projection of a locally trivial $\PP^1$-bundle. 

Primary use: birationally identify potentially singular varieties with smooth varieties.

\begin{proof}
    Step 1: $\PP^1$ is complete. First assume $Y=\PP^m$. Closed subsets are precisely the zero loci of bihomogeneous polys $F(x_0,x_1,\vec y)=a_d(y)x_0^d+a_{d-1}(y)x_0^{d-1}x_1+\cdots +a_0(y)x_1^d$. Two (one-variable) polys share a root/common factor iff $\Res(f,g)=0$. Claim that for $Z\subseteq \PP^1\times\PP^m=Z(\{\Res(f,g):f,g\text{ dehomogenization of }F,G\in I(Z)\})$. Can assume wlog that $Y=\PP^m$ and closed subsets in $Y$ are restrictions of closed set in $\PP^m$, so $\PP^1$ is complete.

    It suffices to show that the second proj of $\PP^n\times \PP^{m}\to\PP^m$ is a closed map for all $n$. Notice that if $V$ is a proj variety and $W\subset V$ a subset with $W\cap U_i$ closed in $U_i$ then $W$ is closed.
    \begin{center}
        % https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZARgBoAGAXVJADcBDAGwFcYkQAhRgfTQAoAOgIAKwgHpgAlELwBbeAAIhosbJABfUuky58hFACYK1Ok1btl4sDKzy4l1Rq0gM2PASJHiJhizaIQBzVNbTc9IjJvGl9zAIdgMABaYnUbOyURcWDnV10PFHJSKNM-dgBVbgM0+CCnULz9ZEKqaLN-QMyxYmq4BQqsHoyVYJMYKABzeCJQADMAJwg1RABWGhwIJHIQkHnFzbWNxDIS2I60AYE5GoEsKDqdhaWAZgOkIxP2oXPK+92lgBZXognts-vsQOskC8PuwAI6DIS3X6PJDHSGId4xT4Cb4GZF7FZA-7qSjqIA
\begin{tikzcd}
\PP^1\times U_i\times \PP^m \arrow[r] \arrow[d] & Bl_p(\PP^n)\times \PP^m \arrow[r, "\pi\times\id"] \arrow[d, "q\times \id"] & \PP^n\times\PP^m \arrow[d, "\pi_2"] \\
U_2\times\PP^m \arrow[r]                        & \PP^{n-1}\times \PP^m \arrow[r, "\pi_2"]                                   & \PP^m                              
\end{tikzcd}
    \end{center}
    Assume $Z$ is closed in $\PP^n$
\end{proof}
\end{document}
